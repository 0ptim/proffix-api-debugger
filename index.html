<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Proffix API Debugger</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <style>
      /* ═══════════════════════════════════════════════
       CSS Custom Properties
       ═══════════════════════════════════════════════ */
      :root {
        --bg-primary: #0f1117;
        --bg-secondary: #161822;
        --bg-tertiary: #1c1f2e;
        --bg-elevated: #232639;
        --bg-input: #1a1d2e;
        --border: #2a2d3e;
        --border-focus: #5b6aff;
        --text-primary: #e4e6f0;
        --text-secondary: #8b8fa8;
        --text-muted: #5a5e78;
        --accent: #5b6aff;
        --accent-hover: #4a58e0;
        --accent-subtle: rgba(91, 106, 255, 0.12);
        --success: #34d399;
        --success-bg: rgba(52, 211, 153, 0.08);
        --success-border: rgba(52, 211, 153, 0.2);
        --warning: #fbbf24;
        --warning-bg: rgba(251, 191, 36, 0.08);
        --warning-border: rgba(251, 191, 36, 0.2);
        --danger: #f87171;
        --danger-bg: rgba(248, 113, 113, 0.08);
        --danger-border: rgba(248, 113, 113, 0.2);
        --info: #60a5fa;
        --method-get: #34d399;
        --method-post: #fbbf24;
        --method-put: #fb923c;
        --method-patch: #a78bfa;
        --method-delete: #f87171;
        --radius-sm: 6px;
        --radius-md: 10px;
        --radius-lg: 14px;
        --shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.4);
        --font-sans: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        --font-mono: "JetBrains Mono", "Fira Code", "Consolas", monospace;
        --transition: 150ms ease;
      }

      /* ═══════════════════════════════════════════════
       Reset & Base
       ═══════════════════════════════════════════════ */
      *,
      *::before,
      *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html {
        font-size: 15px;
        -webkit-font-smoothing: antialiased;
        overflow-y: scroll;
        scrollbar-gutter: stable;
      }

      body {
        font-family: var(--font-sans);
        background: var(--bg-primary);
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
      }

      .hidden {
        display: none !important;
      }

      /* ═══════════════════════════════════════════════
       Layout
       ═══════════════════════════════════════════════ */
      .app {
        max-width: 960px;
        margin: 0 auto;
        padding: 0 20px;
      }

      /* ═══════════════════════════════════════════════
       Header
       ═══════════════════════════════════════════════ */
      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 0;
        border-bottom: 1px solid var(--border);
        margin-bottom: 24px;
        position: sticky;
        top: 0;
        background: var(--bg-primary);
        z-index: 100;
      }

      .header-brand {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 700;
        font-size: 1.1rem;
        color: var(--text-primary);
        text-decoration: none;
        letter-spacing: -0.02em;
      }

      .header-brand svg {
        flex-shrink: 0;
      }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-shrink: 0;
      }

      .header-actions .btn-icon {
        width: 30px;
        height: 30px;
        border: 1px solid var(--border);
        background: var(--bg-secondary);
      }

      .header-actions .btn-icon:hover {
        border-color: var(--danger-border);
        color: var(--danger);
        background: var(--danger-bg);
      }

      /* ═══════════════════════════════════════════════
       Status Bar (Connection + Login)
       ═══════════════════════════════════════════════ */
      .status-bar {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: nowrap;
        margin-left: auto;
        margin-right: 8px;
        min-width: 0;
        overflow-x: auto;
      }

      .status-bar::-webkit-scrollbar {
        height: 0;
      }

      .status-pill {
        display: inline-flex;
        align-items: center;
        gap: 7px;
        padding: 6px 14px;
        border-radius: 100px;
        font-size: 0.8rem;
        font-weight: 500;
        border: 1px solid var(--border);
        background: var(--bg-secondary);
        white-space: nowrap;
        transition: all var(--transition);
        flex-shrink: 0;
      }

      .status-pill .dot {
        width: 7px;
        height: 7px;
        border-radius: 50%;
        flex-shrink: 0;
      }
      .status-pill .dot.red {
        background: var(--danger);
        box-shadow: 0 0 6px var(--danger);
      }
      .status-pill .dot.green {
        background: var(--success);
        box-shadow: 0 0 6px var(--success);
      }
      .status-pill .dot.yellow {
        background: var(--warning);
        box-shadow: 0 0 6px var(--warning);
      }

      @keyframes pulse-dot {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.4;
        }
      }
      .status-pill .dot.pulse {
        animation: pulse-dot 1.2s ease-in-out infinite;
      }

      .status-pill-btn {
        cursor: pointer;
        user-select: none;
      }
      .status-pill-btn:hover {
        border-color: var(--border-focus);
        background: var(--accent-subtle);
      }

      /* ═══════════════════════════════════════════════
       Buttons
       ═══════════════════════════════════════════════ */
      .btn {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 16px;
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        background: var(--bg-secondary);
        color: var(--text-primary);
        font-family: var(--font-sans);
        font-size: 0.85rem;
        font-weight: 500;
        cursor: pointer;
        transition: all var(--transition);
        white-space: nowrap;
        text-decoration: none;
        line-height: 1.4;
      }
      .btn:hover {
        border-color: var(--text-muted);
        background: var(--bg-tertiary);
      }
      .btn:active {
        transform: scale(0.97);
      }
      .btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        pointer-events: none;
      }

      .btn-primary {
        background: var(--accent);
        border-color: var(--accent);
        color: #fff;
      }
      .btn-primary:hover {
        background: var(--accent-hover);
        border-color: var(--accent-hover);
      }

      .btn-danger {
        color: var(--danger);
        border-color: var(--danger-border);
        background: var(--danger-bg);
      }
      .btn-danger:hover {
        background: rgba(248, 113, 113, 0.15);
        border-color: var(--danger);
      }

      .btn-ghost {
        background: transparent;
        border-color: transparent;
        color: var(--text-secondary);
      }
      .btn-ghost:hover {
        color: var(--text-primary);
        background: var(--bg-tertiary);
      }

      .btn-sm {
        padding: 5px 10px;
        font-size: 0.78rem;
      }

      .btn-icon {
        padding: 6px;
        border: none;
        background: transparent;
        color: var(--text-secondary);
        cursor: pointer;
        border-radius: var(--radius-sm);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: all var(--transition);
      }
      .btn-icon:hover {
        color: var(--text-primary);
        background: var(--bg-tertiary);
      }

      /* ═══════════════════════════════════════════════
       Request Builder
       ═══════════════════════════════════════════════ */
      .request-builder {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        padding: 4px;
        margin-bottom: 24px;
      }

      .request-row {
        display: flex;
        align-items: center;
        gap: 0;
      }

      .method-selector {
        position: relative;
      }

      .method-btn {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 10px 14px;
        border: none;
        border-radius: var(--radius-md);
        background: transparent;
        font-family: var(--font-mono);
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        transition: all var(--transition);
        white-space: nowrap;
        letter-spacing: 0.02em;
      }
      .method-btn:hover {
        background: var(--bg-tertiary);
      }
      .method-btn svg {
        transition: transform var(--transition);
      }
      .method-btn.open svg {
        transform: rotate(180deg);
      }

      .method-btn[data-method="GET"] {
        color: var(--method-get);
      }
      .method-btn[data-method="POST"] {
        color: var(--method-post);
      }
      .method-btn[data-method="PUT"] {
        color: var(--method-put);
      }
      .method-btn[data-method="PATCH"] {
        color: var(--method-patch);
      }
      .method-btn[data-method="DELETE"] {
        color: var(--method-delete);
      }

      .method-dropdown {
        position: absolute;
        top: calc(100% + 4px);
        left: 0;
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        padding: 4px;
        min-width: 170px;
        box-shadow: var(--shadow-lg);
        z-index: 200;
        display: none;
      }
      .method-dropdown.show {
        display: block;
      }

      .method-option {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 12px;
        border: none;
        border-radius: var(--radius-sm);
        background: transparent;
        color: var(--text-primary);
        font-family: var(--font-mono);
        font-size: 0.85rem;
        font-weight: 500;
        cursor: pointer;
        width: 100%;
        text-align: left;
        transition: background var(--transition);
      }
      .method-option:hover {
        background: var(--bg-tertiary);
      }
      .method-option .method-label {
        font-family: var(--font-sans);
        font-weight: 400;
        color: var(--text-muted);
        font-size: 0.78rem;
        margin-left: auto;
      }
      .method-option[data-method="GET"] .method-name {
        color: var(--method-get);
      }
      .method-option[data-method="POST"] .method-name {
        color: var(--method-post);
      }
      .method-option[data-method="PUT"] .method-name {
        color: var(--method-put);
      }
      .method-option[data-method="PATCH"] .method-name {
        color: var(--method-patch);
      }
      .method-option[data-method="DELETE"] .method-name {
        color: var(--method-delete);
      }

      .endpoint-input {
        flex: 1;
        background: transparent;
        border: none;
        color: var(--text-primary);
        font-family: var(--font-mono);
        font-size: 0.9rem;
        padding: 10px 12px;
        outline: none;
        min-width: 0;
      }
      .endpoint-input::placeholder {
        color: var(--text-muted);
      }

      .send-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        padding: 0;
        border: none;
        border-radius: var(--radius-md);
        background: var(--accent);
        color: #fff;
        font-family: var(--font-sans);
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        transition: all var(--transition);
        white-space: nowrap;
        margin: 2px;
        flex-shrink: 0;
      }
      .send-btn:hover {
        background: var(--accent-hover);
      }
      .send-btn:active {
        transform: scale(0.97);
      }
      .send-btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
      }
      .send-btn .shortcut {
        display: none;
      }

      .send-btn .icon-wrap {
        width: 16px;
        height: 16px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }

      .send-btn .icon-wrap svg {
        display: block;
      }

      .send-btn .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .send-btn .spinner {
        width: 16px;
        height: 16px;
        border: 2.5px solid rgba(255, 255, 255, 0.45);
        border-top-color: #fff;
        border-radius: 50%;
        animation: spin 0.6s linear infinite;
        display: block;
        box-sizing: border-box;
      }

      .body-editor {
        display: none;
        padding: 0 4px 4px 4px;
      }
      .body-editor.show {
        display: block;
      }

      .body-textarea {
        width: 100%;
        min-height: 180px;
        background: var(--bg-input);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        color: var(--text-primary);
        font-family: var(--font-mono);
        font-size: 0.85rem;
        padding: 14px;
        outline: none;
        resize: vertical;
        line-height: 1.6;
        transition: border-color var(--transition);
      }
      .body-textarea:focus {
        border-color: var(--border-focus);
      }
      .body-textarea::placeholder {
        color: var(--text-muted);
      }

      .body-error {
        color: var(--danger);
        font-size: 0.8rem;
        padding: 6px 8px 0;
      }

      /* ═══════════════════════════════════════════════
       Section Headers
       ═══════════════════════════════════════════════ */
      .section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 16px;
      }

      .section-title {
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-muted);
      }

      .log-count {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 20px;
        height: 20px;
        padding: 0 6px;
        border-radius: 100px;
        background: var(--bg-tertiary);
        font-size: 0.72rem;
        font-weight: 600;
        color: var(--text-secondary);
        margin-left: 8px;
      }

      /* ═══════════════════════════════════════════════
       Log Entries
       ═══════════════════════════════════════════════ */
      .log-entry {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        margin-bottom: 10px;
        overflow: hidden;
        transition: border-color var(--transition);
      }
      .log-entry:hover {
        border-color: var(--text-muted);
      }

      .log-entry.success {
        border-left: 3px solid var(--success);
      }
      .log-entry.error {
        border-left: 3px solid var(--danger);
      }

      .log-header {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 16px;
        cursor: pointer;
        user-select: none;
      }

      .log-method {
        font-family: var(--font-mono);
        font-size: 0.78rem;
        font-weight: 700;
        padding: 2px 8px;
        border-radius: 4px;
        letter-spacing: 0.03em;
      }
      .log-method.GET {
        color: var(--method-get);
        background: rgba(52, 211, 153, 0.1);
      }
      .log-method.POST {
        color: var(--method-post);
        background: rgba(251, 191, 36, 0.1);
      }
      .log-method.PUT {
        color: var(--method-put);
        background: rgba(251, 147, 60, 0.1);
      }
      .log-method.PATCH {
        color: var(--method-patch);
        background: rgba(167, 139, 250, 0.1);
      }
      .log-method.DELETE {
        color: var(--method-delete);
        background: rgba(248, 113, 113, 0.1);
      }

      .log-endpoint {
        font-family: var(--font-mono);
        font-size: 0.85rem;
        color: var(--text-primary);
        flex: 1;
        min-width: 0;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .log-meta {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-shrink: 0;
      }

      .log-status {
        font-family: var(--font-mono);
        font-size: 0.78rem;
        font-weight: 600;
        padding: 2px 8px;
        border-radius: 4px;
      }
      .log-status.ok {
        color: var(--success);
        background: rgba(52, 211, 153, 0.1);
      }
      .log-status.err {
        color: var(--danger);
        background: rgba(248, 113, 113, 0.1);
      }

      .log-duration {
        font-family: var(--font-mono);
        font-size: 0.75rem;
        color: var(--text-muted);
        min-width: 50px;
        text-align: right;
      }

      .log-time {
        font-size: 0.72rem;
        color: var(--text-muted);
      }

      .log-delete-btn {
        width: 20px;
        height: 20px;
        padding: 0;
        border: none;
        border-radius: 4px;
        background: transparent;
        color: var(--text-muted);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all var(--transition);
      }
      .log-delete-btn:hover {
        color: var(--danger);
        background: rgba(248, 113, 113, 0.12);
      }

      .log-chevron {
        color: var(--text-muted);
        transition: transform var(--transition);
        flex-shrink: 0;
      }
      .log-entry.expanded .log-chevron {
        transform: rotate(180deg);
      }

      .log-body {
        display: none;
        border-top: 1px solid var(--border);
        padding: 0;
      }
      .log-entry.expanded .log-body {
        display: block;
      }

      .log-details {
        display: flex;
        gap: 16px;
        padding: 12px 16px;
        font-size: 0.8rem;
        flex-wrap: wrap;
        border-bottom: 1px solid var(--border);
      }

      .log-detail {
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .log-detail-label {
        color: var(--text-muted);
      }
      .log-detail-value {
        font-family: var(--font-mono);
        font-size: 0.78rem;
        color: var(--text-secondary);
      }

      .log-tabs {
        display: flex;
        border-bottom: 1px solid var(--border);
      }

      .log-tab {
        padding: 8px 16px;
        font-size: 0.8rem;
        font-weight: 500;
        color: var(--text-muted);
        background: transparent;
        border: none;
        border-bottom: 2px solid transparent;
        cursor: pointer;
        transition: all var(--transition);
      }
      .log-tab:hover {
        color: var(--text-secondary);
      }
      .log-tab.active {
        color: var(--accent);
        border-bottom-color: var(--accent);
      }

      .log-tab-content {
        display: none;
      }
      .log-tab-content.active {
        display: block;
      }

      .log-code-wrap {
        position: relative;
      }

      .log-code {
        padding: 14px 16px;
        font-family: var(--font-mono);
        font-size: 0.8rem;
        line-height: 1.7;
        color: var(--text-secondary);
        overflow-x: auto;
        white-space: pre-wrap;
        word-break: break-word;
        max-height: 400px;
        overflow-y: auto;
      }

      .log-code::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      .log-code::-webkit-scrollbar-track {
        background: transparent;
      }
      .log-code::-webkit-scrollbar-thumb {
        background: var(--border);
        border-radius: 3px;
      }

      .copy-btn {
        position: absolute;
        top: 8px;
        right: 8px;
        padding: 4px 10px;
        font-size: 0.72rem;
        font-weight: 500;
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        background: var(--bg-elevated);
        color: var(--text-secondary);
        cursor: pointer;
        transition: all var(--transition);
        font-family: var(--font-sans);
        z-index: 5;
      }
      .copy-btn:hover {
        border-color: var(--text-muted);
        color: var(--text-primary);
      }
      .copy-btn.copied {
        color: var(--success);
        border-color: var(--success-border);
      }

      .log-location {
        padding: 10px 16px;
        border-bottom: 1px solid var(--border);
        font-size: 0.8rem;
      }
      .log-location a {
        color: var(--accent);
        text-decoration: none;
      }
      .log-location a:hover {
        text-decoration: underline;
      }

      .log-empty {
        text-align: center;
        padding: 48px 20px;
        color: var(--text-muted);
        font-size: 0.9rem;
      }
      .log-empty svg {
        margin-bottom: 12px;
        opacity: 0.3;
      }

      /* ═══════════════════════════════════════════════
       Modals
       ═══════════════════════════════════════════════ */
      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
        z-index: 1000;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }
      .modal-overlay.show {
        display: flex;
      }

      .modal {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        width: 100%;
        max-width: 480px;
        box-shadow: var(--shadow-lg);
        animation: modal-in 200ms ease;
      }

      @keyframes modal-in {
        from {
          opacity: 0;
          transform: translateY(10px) scale(0.98);
        }
        to {
          opacity: 1;
          transform: none;
        }
      }

      .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 18px 22px;
        border-bottom: 1px solid var(--border);
      }

      .modal-title {
        font-size: 1rem;
        font-weight: 600;
      }

      .modal-close {
        background: transparent;
        border: none;
        color: var(--text-muted);
        cursor: pointer;
        padding: 4px;
        border-radius: var(--radius-sm);
        display: flex;
        transition: all var(--transition);
      }
      .modal-close:hover {
        color: var(--text-primary);
        background: var(--bg-tertiary);
      }

      .modal-body {
        padding: 22px;
      }

      .modal-footer {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 8px;
        padding: 16px 22px;
        border-top: 1px solid var(--border);
      }

      /* ═══════════════════════════════════════════════
       Form Fields
       ═══════════════════════════════════════════════ */
      .form-group {
        margin-bottom: 16px;
      }
      .form-group:last-child {
        margin-bottom: 0;
      }

      .form-label {
        display: block;
        font-size: 0.8rem;
        font-weight: 500;
        color: var(--text-secondary);
        margin-bottom: 6px;
      }

      .form-input,
      .form-select {
        width: 100%;
        padding: 9px 12px;
        background: var(--bg-input);
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        color: var(--text-primary);
        font-family: var(--font-sans);
        font-size: 0.85rem;
        outline: none;
        transition: border-color var(--transition);
      }
      .form-input:focus,
      .form-select:focus {
        border-color: var(--border-focus);
      }
      .form-input::placeholder {
        color: var(--text-muted);
      }

      .form-select {
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L5 5L9 1' stroke='%235a5e78' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        padding-right: 32px;
        cursor: pointer;
      }
      .form-select option {
        background: var(--bg-elevated);
        color: var(--text-primary);
      }

      .form-hint {
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-top: 4px;
      }

      .form-check {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        font-size: 0.83rem;
        color: var(--text-secondary);
      }
      .form-check input[type="checkbox"] {
        width: 16px;
        height: 16px;
        accent-color: var(--accent);
        cursor: pointer;
      }

      .form-group.has-success .form-input,
      .form-group.has-success .form-select {
        border-color: var(--success);
      }

      /* ═══════════════════════════════════════════════
       Session Timeout Banner
       ═══════════════════════════════════════════════ */
      .timeout-banner {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 16px;
        margin-bottom: 16px;
        border: 1px solid var(--warning-border);
        background: var(--warning-bg);
        border-radius: var(--radius-md);
        font-size: 0.85rem;
        color: var(--warning);
      }
      .timeout-banner .btn {
        flex-shrink: 0;
      }

      /* ═══════════════════════════════════════════════
       Scrollbar
       ═══════════════════════════════════════════════ */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: var(--border);
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: var(--text-muted);
      }

      /* ═══════════════════════════════════════════════
       Responsive
       ═══════════════════════════════════════════════ */
      @media (max-width: 640px) {
        .header {
          flex-wrap: wrap;
          gap: 8px;
        }
        .status-bar {
          order: 3;
          width: 100%;
          margin: 4px 0 0;
          overflow-x: auto;
        }
        .log-meta {
          gap: 8px;
        }
        .log-duration {
          display: none;
        }
        .request-row {
          flex-wrap: wrap;
        }
        .endpoint-input {
          min-width: 100%;
        }
        .send-btn .shortcut {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="app">
      <!-- Header -->
      <header class="header">
        <a class="header-brand" href="">
          <svg
            width="22"
            height="22"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <rect x="3" y="4" width="18" height="16" rx="2" ry="2" />
            <line x1="7" y1="9" x2="17" y2="9" />
            <line x1="7" y1="15" x2="12" y2="15" />
          </svg>
          Proffix API Debugger
        </a>
        <div class="status-bar">
          <!-- Connection states -->
          <div class="status-pill status-pill-btn" id="lblConnectionNot">
            <span class="dot red"></span>
            Not connected
          </div>
          <div
            class="status-pill status-pill-btn hidden"
            id="lblConnectionInProgress"
          >
            <span class="dot yellow pulse"></span>
            Connecting...
          </div>
          <div class="status-pill status-pill-btn hidden" id="lblConnectionOk">
            <span class="dot green"></span>
            API <span id="lblRestApiVersion"></span>&nbsp;·&nbsp;<span
              id="lblRestApiUrl"
              style="opacity: 0.7"
            ></span>
          </div>
          <div
            class="status-pill status-pill-btn hidden"
            id="lblConnectionFailed"
          >
            <span class="dot red"></span>
            Connection failed
          </div>

          <!-- Login states -->
          <div class="status-pill status-pill-btn hidden" id="lblLoginNot">
            <span class="dot red"></span>
            Not logged in
          </div>
          <div
            class="status-pill status-pill-btn hidden"
            id="lblLoginInProgress"
          >
            <span class="dot yellow pulse"></span>
            Logging in...
          </div>
          <div class="status-pill status-pill-btn hidden" id="lblLoginOk">
            <span class="dot green"></span>
            <span id="lblUsername"></span>
          </div>
          <div class="status-pill status-pill-btn hidden" id="lblLoginFailed">
            <span class="dot red"></span>
            Login failed
          </div>
        </div>
        <div class="header-actions">
          <button
            type="button"
            class="btn-icon hidden"
            id="btnLogout"
            title="Logout"
            aria-label="Logout"
          >
            <svg
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
              <polyline points="16 17 21 12 16 7" />
              <line x1="21" y1="12" x2="9" y2="12" />
            </svg>
          </button>
        </div>
      </header>

      <!-- Session Timeout Banner -->
      <div class="timeout-banner hidden" id="lblLoginTimeout">
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <circle cx="12" cy="12" r="10" />
          <line x1="12" y1="8" x2="12" y2="12" />
          <line x1="12" y1="16" x2="12.01" y2="16" />
        </svg>
        Session expired
        <button type="button" class="btn btn-sm" id="btnRelogin">
          Log in again
        </button>
      </div>

      <!-- Request Builder -->
      <div class="request-builder">
        <form id="requestform">
          <div class="request-row">
            <div class="method-selector">
              <button
                type="button"
                class="method-btn"
                id="btnHttpMethod"
                data-method="GET"
              >
                <span class="method-text">GET</span>
                <svg
                  width="12"
                  height="12"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <polyline points="6 9 12 15 18 9" />
                </svg>
              </button>
              <div class="method-dropdown" id="lstHttpMethods">
                <button type="button" class="method-option" data-method="GET">
                  <span class="method-name">GET</span
                  ><span class="method-label">fetch</span>
                </button>
                <button type="button" class="method-option" data-method="POST">
                  <span class="method-name">POST</span
                  ><span class="method-label">create</span>
                </button>
                <button type="button" class="method-option" data-method="PUT">
                  <span class="method-name">PUT</span
                  ><span class="method-label">replace</span>
                </button>
                <button type="button" class="method-option" data-method="PATCH">
                  <span class="method-name">PATCH</span
                  ><span class="method-label">update</span>
                </button>
                <button
                  type="button"
                  class="method-option"
                  data-method="DELETE"
                >
                  <span class="method-name">DELETE</span
                  ><span class="method-label">delete</span>
                </button>
              </div>
            </div>
            <input
              type="text"
              class="endpoint-input"
              id="txtEndpoint"
              placeholder="e.g. ADR/Address/1"
              autocomplete="off"
              spellcheck="false"
            />
            <button
              type="submit"
              class="send-btn"
              id="btnSend"
              disabled
              aria-label="Send (Ctrl+Enter)"
              title="Send (Ctrl+Enter)"
            >
              <span class="icon-wrap" id="iconSend" aria-hidden="true">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <line x1="22" y1="2" x2="11" y2="13" />
                  <polygon points="22 2 15 22 11 13 2 9 22 2" />
                </svg>
              </span>
              <span class="sr-only">Send</span>
              <span class="shortcut">Ctrl+↵</span>
            </button>
          </div>
          <div class="body-editor" id="httpbody">
            <textarea
              class="body-textarea"
              id="txtHttpBody"
              placeholder='{ "key": "value" }'
              spellcheck="false"
            ></textarea>
            <div class="body-error hidden" id="lblHttpBodyError"></div>
          </div>
        </form>
      </div>

      <!-- Log Section -->
      <div class="section-header">
        <div>
          <span class="section-title">Response Log</span>
          <span class="log-count hidden" id="logCount">0</span>
        </div>
        <button type="button" class="btn btn-ghost btn-sm" id="btnLogClear">
          <svg
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <polyline points="3 6 5 6 21 6" />
            <path
              d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
            />
          </svg>
          Clear
        </button>
      </div>

      <div id="output">
        <div class="log-empty" id="logEmpty">
          <svg
            width="40"
            height="40"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="12" r="10" />
            <line x1="12" y1="8" x2="12" y2="12" />
            <line x1="12" y1="16" x2="12.01" y2="16" />
          </svg>
          <div>No requests sent yet</div>
        </div>
      </div>

      <div style="height: 60px"></div>
    </div>

    <!-- Connection Settings Modal -->
    <div class="modal-overlay" id="modalConnectionSettings">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title">Connection settings</h3>
          <button type="button" class="modal-close" data-dismiss="modal">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label" for="txtConnSettRestApiUrl"
              >REST API URL</label
            >
            <input
              type="url"
              class="form-input"
              id="txtConnSettRestApiUrl"
              placeholder="https://remote.proffix.net:11011/pxapi/v4"
            />
            <div class="form-hint">
              e.g. https://remote.proffix.net:11011/pxapi/v4
            </div>
          </div>
          <div class="form-group">
            <label class="form-label" for="txtConnSettRestApiPwd"
              >Password (plain text)</label
            >
            <input
              type="password"
              class="form-input"
              id="txtConnSettRestApiPwd"
              placeholder="Will be hashed automatically"
            />
          </div>
          <div class="form-group">
            <label class="form-label" for="txtConnSettRestApiPwdHash"
              >Password (SHA-256 hash)</label
            >
            <input
              type="password"
              class="form-input"
              id="txtConnSettRestApiPwdHash"
              placeholder="Alternative: already hashed password"
            />
          </div>
          <div class="form-group">
            <label class="form-check">
              <input type="checkbox" id="chkConnSettRemember" />
              Save to local storage
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="btnConnect">
            <svg
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"
              />
              <polyline points="22,6 12,13 2,6" />
            </svg>
            Connect
          </button>
        </div>
      </div>
    </div>

    <!-- Login Modal -->
    <div class="modal-overlay" id="modalLogin">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title">Login</h3>
          <button type="button" class="modal-close" data-dismiss="modal">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label" for="selDatabase">Database</label>
            <select class="form-select" id="selDatabase"></select>
            <div class="form-hint">Log out before switching.</div>
          </div>
          <div class="form-group">
            <label class="form-label" for="txtLoginUsername">Username</label>
            <input
              type="text"
              class="form-input"
              id="txtLoginUsername"
              autocomplete="username"
            />
          </div>
          <div class="form-group">
            <label class="form-label" for="txtLoginPwd"
              >Password (plain text)</label
            >
            <input
              type="password"
              class="form-input"
              id="txtLoginPwd"
              autocomplete="current-password"
            />
          </div>
          <div class="form-group">
            <label class="form-label" for="txtLoginPwdHash"
              >Password (SHA-256 hash)</label
            >
            <input type="password" class="form-input" id="txtLoginPwdHash" />
          </div>
          <div class="form-group">
            <label class="form-check">
              <input type="checkbox" id="chkLoginRemember" />
              Save to local storage
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="btnLogin">
            <svg
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" />
              <polyline points="10 17 15 12 10 7" />
              <line x1="15" y1="12" x2="3" y2="12" />
            </svg>
            Login
          </button>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
      "use strict";

      // ═══════════════════════════════════════════════
      // State
      // ═══════════════════════════════════════════════
      var loginObject = null;
      var connectionSettings = null;
      var pxSessionId;
      var noOfRequests = 0;
      var wasLoggedIn = false;
      var selectedHttpMethod = "GET";
      var logcounter = 0;

      // ═══════════════════════════════════════════════
      // Constants
      // ═══════════════════════════════════════════════
      const STORAGENAME_CONNECTIONSETTINGS = "PxRestApiConnectionSettings";
      const STORAGENAME_LOGINOBJECT = "PxRestApiLoginObject";

      // ═══════════════════════════════════════════════
      // Custom modal show/hide (replaces Bootstrap modals)
      // ═══════════════════════════════════════════════
      function showModal(id) {
        var el = document.getElementById(id);
        if (el) {
          el.classList.add("show");
        }
      }
      function hideModal(id) {
        var el = document.getElementById(id);
        if (el) {
          el.classList.remove("show");
        }
      }
      // Close on overlay click or dismiss buttons
      $(document).on("click", ".modal-overlay", function (e) {
        if (e.target === this) $(this).removeClass("show");
      });
      $(document).on("click", "[data-dismiss='modal']", function () {
        $(this).closest(".modal-overlay").removeClass("show");
      });
      // Esc to close
      $(document).on("keydown", function (e) {
        if (e.key === "Escape") $(".modal-overlay.show").removeClass("show");
      });

      // ═══════════════════════════════════════════════
      // API Call
      // ═══════════════════════════════════════════════
      var doApiCall = function (method, endpoint, success, error, data) {
        noOfRequests++;
        updateSendButton();

        var starttime = Date.now();
        $.ajax({
          url:
            connectionSettings.url +
            "/" +
            endpoint
              .replace(/^\/+/g, "")
              .replace(/([pP][xX][aA][pP][iI]\/v[0-9]|v[0-9])/g, "")
              .replace(/^\/+/g, ""),
          method: method,
          headers: {
            "Content-Type": "application/json",
            PxSessionId: pxSessionId,
          },
          data: JSON.stringify(data),
          timeout: 60000,
          success: function (responseObject, status, request) {
            var endtime = Date.now();
            pxSessionId = request.getResponseHeader("PxSessionId");
            writeLog(
              method.toUpperCase(),
              endpoint,
              request.status,
              request.statusText,
              responseObject ? JSON.stringify(responseObject, null, 2) : "",
              data ? JSON.stringify(data, null, 2) : "",
              endtime - starttime,
              method == "POST" ? request.getResponseHeader("Location") : null,
            );
            decreaseNoOfRequests();
            $("#lblLoginTimeout").addClass("hidden");
            if (success != undefined) success(responseObject, status);
          },
          error: function (request) {
            var endtime = Date.now();
            pxSessionId = request.getResponseHeader("PxSessionId");
            if (wasLoggedIn && request.status === 401) {
              $("#lblLoginTimeout").removeClass("hidden");
            }
            var responseTextForLog = request.responseText || "";
            if (responseTextForLog.length > 0) {
              try {
                responseTextForLog = JSON.stringify(
                  JSON.parse(responseTextForLog),
                  null,
                  2,
                );
              } catch (e) {}
            }
            writeLog(
              method.toUpperCase(),
              endpoint,
              request.status,
              request.statusText,
              responseTextForLog,
              data ? JSON.stringify(data, null, 2) : "",
              endtime - starttime,
            );
            decreaseNoOfRequests();
            if (error != undefined) error(request.responseJSON, request.status);
          },
        });
      };

      // ═══════════════════════════════════════════════
      // Send Button State
      // ═══════════════════════════════════════════════
      var updateSendButton = function () {
        if (noOfRequests > 0) {
          $("#iconSend").html('<span class="spinner"></span>');
        } else {
          $("#iconSend").html(
            '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>',
          );
        }
      };

      var decreaseNoOfRequests = function () {
        noOfRequests--;
        if (noOfRequests === 0) updateSendButton();
      };

      // ═══════════════════════════════════════════════
      // Field Validation
      // ═══════════════════════════════════════════════
      var fieldValidation = function (inputElem, validationMethod) {
        var formgroup = inputElem.closest("div.form-group");
        formgroup.removeClass("has-success");
        if (validationMethod(inputElem.val())) {
          formgroup.addClass("has-success");
          return true;
        }
        return false;
      };

      // ═══════════════════════════════════════════════
      // Syntax Highlighting for JSON
      // ═══════════════════════════════════════════════
      function syntaxHighlight(json) {
        if (!json) return "";
        json = json
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
        return json.replace(
          /("(\\u[\da-fA-F]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,
          function (match) {
            var cls = "color:#a78bfa"; // number
            if (/^"/.test(match)) {
              if (/:$/.test(match)) {
                cls = "color:#60a5fa"; // key
              } else {
                cls = "color:#34d399"; // string
              }
            } else if (/true|false/.test(match)) {
              cls = "color:#fbbf24"; // boolean
            } else if (/null/.test(match)) {
              cls = "color:#f87171"; // null
            }
            return '<span style="' + cls + '">' + match + "</span>";
          },
        );
      }

      // ═══════════════════════════════════════════════
      // Write Log Entry
      // ═══════════════════════════════════════════════
      var writeLog = function (
        method,
        endpoint,
        statuscode,
        statuscodetext,
        response,
        request,
        duration,
        locationHeader,
      ) {
        logcounter++;
        $("#logEmpty").addClass("hidden");

        var isSuccess = statuscode >= 200 && statuscode < 300;
        var statusClass = isSuccess ? "ok" : "err";
        var entryClass = isSuccess ? "success" : "error";
        var now = new Date();
        var timeStr = now.toLocaleTimeString("en-CH", {
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        });

        // Build location HTML
        var locationHtml = "";
        if (locationHeader) {
          if (locationHeader.includes("/PRO/Datei/")) {
            locationHtml =
              '<div class="log-location"><span style="color:var(--text-muted)">Location:</span> <a href="' +
              locationHeader +
              "?pxSessionId=" +
              pxSessionId +
              '" target="_blank">' +
              locationHeader +
              "</a></div>";
          } else {
            locationHtml =
              '<div class="log-location"><span style="color:var(--text-muted)">Location:</span> ' +
              escapeHtml(locationHeader) +
              "</div>";
          }
        }

        var id = "log-" + logcounter;
        var highlightedResponse = response
          ? syntaxHighlight(response)
          : '<span style="color:var(--text-muted)">— leer —</span>';
        var highlightedRequest = request
          ? syntaxHighlight(request)
          : '<span style="color:var(--text-muted)">— leer —</span>';

        var entry = $(
          '<div class="log-entry ' +
            entryClass +
            ' expanded" data-id="' +
            id +
            '">' +
            '<div class="log-header">' +
            '<span class="log-method ' +
            method +
            '">' +
            method +
            "</span>" +
            '<span class="log-endpoint">' +
            escapeHtml(endpoint) +
            "</span>" +
            '<div class="log-meta">' +
            '<span class="log-status ' +
            statusClass +
            '">' +
            statuscode +
            " " +
            statuscodetext +
            "</span>" +
            '<span class="log-duration">' +
            duration +
            "ms</span>" +
            '<span class="log-time">' +
            timeStr +
            "</span>" +
            '<button type="button" class="log-delete-btn" title="Delete entry" aria-label="Delete entry"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>' +
            '<svg class="log-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>' +
            "</div>" +
            "</div>" +
            '<div class="log-body">' +
            locationHtml +
            '<div class="log-tabs">' +
            '<button type="button" class="log-tab active" data-tab="response-' +
            id +
            '">Response</button>' +
            '<button type="button" class="log-tab" data-tab="request-' +
            id +
            '">Request</button>' +
            "</div>" +
            '<div class="log-tab-content active" id="response-' +
            id +
            '">' +
            '<div class="log-code-wrap">' +
            '<button type="button" class="copy-btn" data-copy="response" data-id="' +
            id +
            '">Copy</button>' +
            '<div class="log-code">' +
            highlightedResponse +
            "</div>" +
            "</div>" +
            "</div>" +
            '<div class="log-tab-content" id="request-' +
            id +
            '">' +
            '<div class="log-code-wrap">' +
            '<button type="button" class="copy-btn" data-copy="request" data-id="' +
            id +
            '">Copy</button>' +
            '<div class="log-code">' +
            highlightedRequest +
            "</div>" +
            "</div>" +
            "</div>" +
            "</div>" +
            "</div>",
        );

        // Store raw data for copy
        entry.data("response", response || "");
        entry.data("request", request || "");

        $("#output").prepend(entry);
        updateLogCount();
      };

      function updateLogCount() {
        var count = $("#output .log-entry").length;
        if (count > 0) {
          $("#logCount").text(count).removeClass("hidden");
        } else {
          $("#logCount").addClass("hidden");
        }
      }

      function escapeHtml(str) {
        if (!str) return "";
        return str
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;");
      }

      function getApiHostDisplay(url) {
        if (!url) return "";
        try {
          return new URL(url).host;
        } catch (e) {
          return url.replace(/^[a-z]+:\/\//i, "").split("/")[0];
        }
      }

      // ═══════════════════════════════════════════════
      // Connect
      // ═══════════════════════════════════════════════
      var doConnect = function (trySaveSettings) {
        $("#lblConnectionNot").addClass("hidden");
        $("#lblConnectionInProgress").removeClass("hidden");
        $("#lblConnectionOk").addClass("hidden");
        $("#lblConnectionFailed").addClass("hidden");

        doApiCall(
          "GET",
          "PRO/Info?key=" + connectionSettings.pwd,
          function (info) {
            $("#lblConnectionInProgress").addClass("hidden");
            $("#lblConnectionOk").removeClass("hidden");
            $("#lblRestApiVersion").text(info.Version);
            $("#lblRestApiUrl").text(getApiHostDisplay(connectionSettings.url));
            $("#btnSend").removeAttr("disabled");

            // Show login-not after connected
            if (!wasLoggedIn) {
              $("#lblLoginNot").removeClass("hidden");
            }

            if (trySaveSettings) {
              fieldValidation($("#txtConnSettRestApiUrl"), function () {
                return true;
              });
              fieldValidation($("#txtConnSettRestApiPwd"), function () {
                return true;
              });
              if ($("#chkConnSettRemember").val()) {
                if (localStorage) {
                  localStorage.setItem(
                    STORAGENAME_CONNECTIONSETTINGS,
                    JSON.stringify({ default: connectionSettings }),
                  );
                }
              }
            }

            // Load databases
            $("#selDatabase option").remove();
            $("#selDatabase")
              .attr("disabled", "disabled")
              .append("<option>No databases found</option>");
            doApiCall(
              "GET",
              "PRO/Datenbank?key=" + connectionSettings.pwd,
              function (databases) {
                $("#selDatabase option").remove();
                $("#selDatabase").removeAttr("disabled");
                $.each(databases, function (index, database) {
                  $("#selDatabase").append(
                    '<option value="' +
                      database.Name +
                      '">' +
                      database.Bezeichnung +
                      " (" +
                      database.Name +
                      ")</option>",
                  );
                });
                if (
                  loginObject &&
                  loginObject.Datenbank &&
                  loginObject.Datenbank.Name
                ) {
                  $("#selDatabase").val(loginObject.Datenbank.Name);
                }
              },
            );
          },
          function () {
            $("#lblConnectionInProgress").addClass("hidden");
            $("#lblConnectionFailed").removeClass("hidden");
          },
        );
      };

      // ═══════════════════════════════════════════════
      // Login
      // ═══════════════════════════════════════════════
      var doLogin = function (trySaveSettings) {
        $("#lblLoginNot").addClass("hidden");
        $("#lblLoginInProgress").removeClass("hidden");
        $("#lblLoginOk").addClass("hidden");
        $("#lblLoginFailed").addClass("hidden");

        doApiCall(
          "POST",
          "PRO/Login",
          function () {
            $("#lblLoginInProgress").addClass("hidden");
            $("#lblLoginOk").removeClass("hidden");
            $("#btnLogout").removeClass("hidden");
            wasLoggedIn = true;

            doApiCall("GET", "PRO/Login", function (login) {
              $("#lblUsername").text(
                login.Benutzer + " · " + login.Datenbank.Name,
              );
            });

            if (trySaveSettings) {
              fieldValidation($("#selDatabase"), function () {
                return true;
              });
              fieldValidation($("#txtLoginUsername"), function () {
                return true;
              });
              fieldValidation($("#txtLoginPwd"), function () {
                return true;
              });
              if ($("#chkLoginRemember").val()) {
                if (localStorage) {
                  localStorage.setItem(
                    STORAGENAME_LOGINOBJECT,
                    JSON.stringify({ default: loginObject }),
                  );
                }
              }
            }
          },
          function () {
            $("#lblLoginInProgress").addClass("hidden");
            $("#lblLoginFailed").removeClass("hidden");
            wasLoggedIn = false;
          },
          loginObject,
        );
      };

      // ═══════════════════════════════════════════════
      // Set HTTP Method
      // ═══════════════════════════════════════════════
      var setHttpMethod = function (method) {
        selectedHttpMethod = method;
        var btn = document.getElementById("btnHttpMethod");
        btn.setAttribute("data-method", method);
        btn.querySelector(".method-text").textContent = method;

        // Show/hide body editor
        var bodyEditor = document.getElementById("httpbody");
        if (method === "POST" || method === "PUT" || method === "PATCH") {
          bodyEditor.classList.add("show");
        } else {
          bodyEditor.classList.remove("show");
        }
      };

      // ═══════════════════════════════════════════════
      // URL Params
      // ═══════════════════════════════════════════════
      var getUrlParam = function (name) {
        var url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
          results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return "";
        return decodeURIComponent(results[2].replace(/\+/g, " "));
      };

      // ═══════════════════════════════════════════════
      // DOM Ready
      // ═══════════════════════════════════════════════
      $(document).ready(function () {
        // URL params
        var paramUrl = getUrlParam("url");
        var paramPwhash = getUrlParam("pwhash");
        if (paramUrl != null && paramPwhash != null) {
          connectionSettings = {
            url: paramUrl + "/pxapi/v4",
            pwd: paramPwhash,
          };
          $("#txtConnSettRestApiUrl").val(connectionSettings.url);
        }

        // Local Storage
        if (localStorage && paramUrl == null && paramPwhash == null) {
          var storageString = localStorage.getItem(
            STORAGENAME_CONNECTIONSETTINGS,
          );
          if (storageString) {
            connectionSettings = JSON.parse(storageString).default;
            $("#txtConnSettRestApiUrl").val(connectionSettings.url);
          }
          storageString = localStorage.getItem(STORAGENAME_LOGINOBJECT);
          if (storageString) {
            loginObject = JSON.parse(storageString).default;
            $("#txtLoginUsername").val(loginObject.Benutzer);
            loginObject.Module = ["VOL"];
          }
        }

        // Auto-connect and login
        if (connectionSettings) doConnect(false);
        if (loginObject) doLogin(false);

        // ═══════════════════════════════════════════════
        // Events
        // ═══════════════════════════════════════════════

        // Connection settings via status pills
        $(
          "#lblConnectionNot, #lblConnectionInProgress, #lblConnectionOk, #lblConnectionFailed",
        ).click(function () {
          showModal("modalConnectionSettings");
        });

        // Login via status pills
        $(
          "#lblLoginNot, #lblLoginInProgress, #lblLoginOk, #lblLoginFailed",
        ).click(function () {
          showModal("modalLogin");
        });

        // Connect
        $("#btnConnect").click(function () {
          if (
            fieldValidation($("#txtConnSettRestApiUrl"), function (val) {
              return val != "";
            })
          ) {
            let passwordHash;
            const clearTextPassword = $("#txtConnSettRestApiPwd").val();
            if (clearTextPassword) {
              passwordHash = sha256(clearTextPassword).toString();
            } else {
              passwordHash = $("#txtConnSettRestApiPwdHash").val();
            }
            if (passwordHash) {
              connectionSettings = {
                url: $("#txtConnSettRestApiUrl").val(),
                pwd: passwordHash,
              };
              doConnect($("#chkConnSettRemember").val());
              hideModal("modalConnectionSettings");
            } else {
              alert("Please enter a password or password hash.");
            }
          }
        });

        // Login
        $("#btnLogin").click(function () {
          if (
            fieldValidation($("#selDatabase"), function (val) {
              return val != "";
            }) &&
            fieldValidation($("#txtLoginUsername"), function (val) {
              return val != "";
            })
          ) {
            var modArr = ["VOL"];
            let passwordHash;
            const clearTextPassword = $("#txtLoginPwd").val();
            if (clearTextPassword) {
              passwordHash = sha256(clearTextPassword).toString();
            } else {
              passwordHash = $("#txtLoginPwdHash").val();
            }
            if (passwordHash) {
              loginObject = {
                Benutzer: $("#txtLoginUsername").val(),
                Passwort: passwordHash,
                Module: modArr,
                Datenbank: { Name: $("#selDatabase").val() },
              };
              doLogin($("#chkLoginRemember").val());
              hideModal("modalLogin");
            } else {
              alert("Please enter a password or password hash.");
            }
          }
        });

        // Logout
        $("#btnLogout").click(function () {
          doApiCall("DELETE", "PRO/Login");
          $("#lblLoginInProgress").addClass("hidden");
          $("#lblLoginOk").addClass("hidden");
          $("#lblLoginFailed").addClass("hidden");
          $("#lblLoginTimeout").addClass("hidden");
          $("#lblLoginNot").removeClass("hidden");
          $("#btnLogout").addClass("hidden");
        });

        // Relogin
        $("#btnRelogin").click(function () {
          doLogin();
        });

        // Clear log
        $("#btnLogClear").click(function () {
          $("#output").empty();
          $("#output").append(
            '<div class="log-empty" id="logEmpty"><svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><div>No requests sent yet</div></div>',
          );
          logcounter = 0;
          updateLogCount();
        });

        // Method dropdown
        $("#btnHttpMethod").click(function (e) {
          e.stopPropagation();
          var dd = $("#lstHttpMethods");
          dd.toggleClass("show");
          $(this).toggleClass("open");
        });

        $(document).click(function () {
          $("#lstHttpMethods").removeClass("show");
          $("#btnHttpMethod").removeClass("open");
        });

        $(".method-option").click(function (e) {
          e.preventDefault();
          e.stopPropagation();
          setHttpMethod($(this).attr("data-method"));
          $("#lstHttpMethods").removeClass("show");
          $("#btnHttpMethod").removeClass("open");
        });

        // Log entry expand/collapse
        $(document).on("click", ".log-header", function () {
          $(this).closest(".log-entry").toggleClass("expanded");
        });

        // Delete single log entry
        $(document).on("click", ".log-delete-btn", function (e) {
          e.stopPropagation();
          $(this).closest(".log-entry").remove();
          if ($("#output .log-entry").length === 0) {
            var empty = $("#logEmpty");
            if (empty.length > 0) {
              empty.removeClass("hidden");
            } else {
              $("#output").append(
                '<div class="log-empty" id="logEmpty"><svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><div>No requests sent yet</div></div>',
              );
            }
          }
          updateLogCount();
        });

        // Log tabs
        $(document).on("click", ".log-tab", function (e) {
          e.stopPropagation();
          var entry = $(this).closest(".log-entry");
          entry.find(".log-tab").removeClass("active");
          entry.find(".log-tab-content").removeClass("active");
          $(this).addClass("active");
          entry.find("#" + $(this).data("tab")).addClass("active");
        });

        // Copy button
        $(document).on("click", ".copy-btn", function (e) {
          e.stopPropagation();
          var btn = $(this);
          var entry = btn.closest(".log-entry");
          var type = btn.data("copy");
          var text = entry.data(type) || "";

          navigator.clipboard.writeText(text).then(function () {
            btn.text("Copied!").addClass("copied");
            setTimeout(function () {
              btn.text("Copy").removeClass("copied");
            }, 1500);
          });
        });

        // Submit request form
        $("#requestform").submit(function (event) {
          event.preventDefault();

          var endpointValid = fieldValidation(
            $("#txtEndpoint"),
            function (val) {
              return val != "" && val.length && val.length > 4;
            },
          );
          var httpbodyValid = true;
          var payload;
          $("#lblHttpBodyError").addClass("hidden").text("");

          if (
            selectedHttpMethod == "POST" ||
            selectedHttpMethod == "PUT" ||
            selectedHttpMethod == "PATCH"
          ) {
            var bodyVal = $("#txtHttpBody").val();
            if (bodyVal && bodyVal.length > 0) {
              try {
                payload = JSON.parse(bodyVal);
              } catch (e) {
                $("#lblHttpBodyError").text(e.toString()).removeClass("hidden");
                httpbodyValid = false;
              }
            }
          }

          if (endpointValid && httpbodyValid) {
            doApiCall(
              selectedHttpMethod,
              $("#txtEndpoint").val(),
              null,
              null,
              payload,
            );
          }
        });

        // Ctrl+Enter to send
        $(document).on("keydown", function (e) {
          if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
            e.preventDefault();
            $("#requestform").submit();
          }
        });
      });

      // ═══════════════════════════════════════════════
      // SHA-256
      // js-sha256 v0.3.0 https://github.com/emn178/js-sha256
      // Copyright 2014-2015, emn178@gmail.com
      // Licensed under the MIT license
      // ═══════════════════════════════════════════════
      (function (I, R) {
        var K = "undefined" != typeof module;
        K && (I = global);
        var a = "0123456789abcdef".split(""),
          Q = [-2147483648, 8388608, 32768, 128],
          C = [24, 16, 8, 0],
          M = [
            1116352408, 1899447441, 3049323471, 3921009573, 961987163,
            1508970993, 2453635748, 2870763221, 3624381080, 310598401,
            607225278, 1426881987, 1925078388, 2162078206, 2614888103,
            3248222580, 3835390401, 4022224774, 264347078, 604807628, 770255983,
            1249150122, 1555081692, 1996064986, 2554220882, 2821834349,
            2952996808, 3210313671, 3336571891, 3584528711, 113926993,
            338241895, 666307205, 773529912, 1294757372, 1396182291, 1695183700,
            1986661051, 2177026350, 2456956037, 2730485921, 2820302411,
            3259730800, 3345764771, 3516065817, 3600352804, 4094571909,
            275423344, 430227734, 506948616, 659060556, 883997877, 958139571,
            1322822218, 1537002063, 1747873779, 1955562222, 2024104815,
            2227730452, 2361852424, 2428436474, 2756734187, 3204031479,
            3329325298,
          ],
          c = [],
          L = function (a) {
            return A(a, !0);
          },
          A = function (D, A) {
            var J = "string" != typeof D;
            J && D.constructor == I.ArrayBuffer && (D = new Uint8Array(D));
            var m,
              n,
              p,
              q,
              r,
              t,
              u,
              v,
              f,
              K = !0,
              L = !1,
              b,
              B = 0,
              N = 0,
              P = 0,
              O = D.length,
              e,
              d,
              E,
              F,
              G,
              H;
            A
              ? ((m = 3238371032),
                (n = 914150663),
                (p = 812702999),
                (q = 4144912697),
                (r = 4290775857),
                (t = 1750603025),
                (u = 1694076839),
                (v = 3204075428))
              : ((m = 1779033703),
                (n = 3144134277),
                (p = 1013904242),
                (q = 2773480762),
                (r = 1359893119),
                (t = 2600822924),
                (u = 528734635),
                (v = 1541459225));
            f = 0;
            do {
              c[0] = f;
              c[16] =
                c[1] =
                c[2] =
                c[3] =
                c[4] =
                c[5] =
                c[6] =
                c[7] =
                c[8] =
                c[9] =
                c[10] =
                c[11] =
                c[12] =
                c[13] =
                c[14] =
                c[15] =
                  0;
              if (J)
                for (b = N; B < O && 64 > b; ++B)
                  c[b >> 2] |= D[B] << C[b++ & 3];
              else
                for (b = N; B < O && 64 > b; ++B)
                  ((f = D.charCodeAt(B)),
                    128 > f
                      ? (c[b >> 2] |= f << C[b++ & 3])
                      : (2048 > f
                          ? (c[b >> 2] |= (192 | (f >> 6)) << C[b++ & 3])
                          : (55296 > f || 57344 <= f
                              ? (c[b >> 2] |= (224 | (f >> 12)) << C[b++ & 3])
                              : (f =
                                  65536 +
                                  (((f & 1023) << 10) |
                                    (D.charCodeAt(++B) & 1023))),
                            (c[b >> 2] |= (240 | (f >> 18)) << C[b++ & 3]),
                            (c[b >> 2] |=
                              (128 | ((f >> 12) & 63)) << C[b++ & 3])),
                        (c[b >> 2] |= (128 | (f & 63)) << C[b++ & 3])));
              P += b - N;
              N = b - 64;
              B == O && ((c[b >> 2] |= Q[b & 3]), ++B);
              f = c[16];
              B > O && 56 > b && ((c[15] = P << 3), (L = !0));
              var w = m,
                k = n,
                l = p,
                g = q,
                x = r,
                y = t,
                z = u,
                h = v;
              for (b = 16; 64 > b; ++b)
                ((d = c[b - 15]),
                  (e =
                    ((d >>> 7) | (d << 25)) ^
                    ((d >>> 18) | (d << 14)) ^
                    (d >>> 3)),
                  (d = c[b - 2]),
                  (d =
                    ((d >>> 17) | (d << 15)) ^
                    ((d >>> 19) | (d << 13)) ^
                    (d >>> 10)),
                  (c[b] = (c[b - 16] + e + c[b - 7] + d) << 0));
              H = k & l;
              for (b = 0; 64 > b; b += 4)
                (K
                  ? (A
                      ? ((G = 300032),
                        (d = c[0] - 1413257819),
                        (h = (d - 150054599) << 0),
                        (g = (d + 24177077) << 0))
                      : ((G = 704751109),
                        (d = c[0] - 210244248),
                        (h = (d - 1521486534) << 0),
                        (g = (d + 143694565) << 0)),
                    (K = !1))
                  : ((e =
                      ((w >>> 2) | (w << 30)) ^
                      ((w >>> 13) | (w << 19)) ^
                      ((w >>> 22) | (w << 10))),
                    (d =
                      ((x >>> 6) | (x << 26)) ^
                      ((x >>> 11) | (x << 21)) ^
                      ((x >>> 25) | (x << 7))),
                    (G = w & k),
                    (E = G ^ (w & l) ^ H),
                    (F = (x & y) ^ (~x & z)),
                    (d = h + d + F + M[b] + c[b]),
                    (e += E),
                    (h = (g + d) << 0),
                    (g = (d + e) << 0)),
                  (e =
                    ((g >>> 2) | (g << 30)) ^
                    ((g >>> 13) | (g << 19)) ^
                    ((g >>> 22) | (g << 10))),
                  (d =
                    ((h >>> 6) | (h << 26)) ^
                    ((h >>> 11) | (h << 21)) ^
                    ((h >>> 25) | (h << 7))),
                  (H = g & w),
                  (E = H ^ (g & k) ^ G),
                  (F = (h & x) ^ (~h & y)),
                  (d = z + d + F + M[b + 1] + c[b + 1]),
                  (e += E),
                  (z = (l + d) << 0),
                  (l = (d + e) << 0),
                  (e =
                    ((l >>> 2) | (l << 30)) ^
                    ((l >>> 13) | (l << 19)) ^
                    ((l >>> 22) | (l << 10))),
                  (d =
                    ((z >>> 6) | (z << 26)) ^
                    ((z >>> 11) | (z << 21)) ^
                    ((z >>> 25) | (z << 7))),
                  (G = l & g),
                  (E = G ^ (l & w) ^ H),
                  (F = (z & h) ^ (~z & x)),
                  (d = y + d + F + M[b + 2] + c[b + 2]),
                  (e += E),
                  (y = (k + d) << 0),
                  (k = (d + e) << 0),
                  (e =
                    ((k >>> 2) | (k << 30)) ^
                    ((k >>> 13) | (k << 19)) ^
                    ((k >>> 22) | (k << 10))),
                  (d =
                    ((y >>> 6) | (y << 26)) ^
                    ((y >>> 11) | (y << 21)) ^
                    ((y >>> 25) | (y << 7))),
                  (H = k & l),
                  (E = H ^ (k & g) ^ G),
                  (F = (y & z) ^ (~y & h)),
                  (d = x + d + F + M[b + 3] + c[b + 3]),
                  (e += E),
                  (x = (w + d) << 0),
                  (w = (d + e) << 0));
              m = (m + w) << 0;
              n = (n + k) << 0;
              p = (p + l) << 0;
              q = (q + g) << 0;
              r = (r + x) << 0;
              t = (t + y) << 0;
              u = (u + z) << 0;
              v = (v + h) << 0;
            } while (!L);
            J =
              a[(m >> 28) & 15] +
              a[(m >> 24) & 15] +
              a[(m >> 20) & 15] +
              a[(m >> 16) & 15] +
              a[(m >> 12) & 15] +
              a[(m >> 8) & 15] +
              a[(m >> 4) & 15] +
              a[m & 15] +
              a[(n >> 28) & 15] +
              a[(n >> 24) & 15] +
              a[(n >> 20) & 15] +
              a[(n >> 16) & 15] +
              a[(n >> 12) & 15] +
              a[(n >> 8) & 15] +
              a[(n >> 4) & 15] +
              a[n & 15] +
              a[(p >> 28) & 15] +
              a[(p >> 24) & 15] +
              a[(p >> 20) & 15] +
              a[(p >> 16) & 15] +
              a[(p >> 12) & 15] +
              a[(p >> 8) & 15] +
              a[(p >> 4) & 15] +
              a[p & 15] +
              a[(q >> 28) & 15] +
              a[(q >> 24) & 15] +
              a[(q >> 20) & 15] +
              a[(q >> 16) & 15] +
              a[(q >> 12) & 15] +
              a[(q >> 8) & 15] +
              a[(q >> 4) & 15] +
              a[q & 15] +
              a[(r >> 28) & 15] +
              a[(r >> 24) & 15] +
              a[(r >> 20) & 15] +
              a[(r >> 16) & 15] +
              a[(r >> 12) & 15] +
              a[(r >> 8) & 15] +
              a[(r >> 4) & 15] +
              a[r & 15] +
              a[(t >> 28) & 15] +
              a[(t >> 24) & 15] +
              a[(t >> 20) & 15] +
              a[(t >> 16) & 15] +
              a[(t >> 12) & 15] +
              a[(t >> 8) & 15] +
              a[(t >> 4) & 15] +
              a[t & 15] +
              a[(u >> 28) & 15] +
              a[(u >> 24) & 15] +
              a[(u >> 20) & 15] +
              a[(u >> 16) & 15] +
              a[(u >> 12) & 15] +
              a[(u >> 8) & 15] +
              a[(u >> 4) & 15] +
              a[u & 15];
            A ||
              (J +=
                a[(v >> 28) & 15] +
                a[(v >> 24) & 15] +
                a[(v >> 20) & 15] +
                a[(v >> 16) & 15] +
                a[(v >> 12) & 15] +
                a[(v >> 8) & 15] +
                a[(v >> 4) & 15] +
                a[v & 15]);
            return J;
          };
        !I.JS_SHA256_TEST && K
          ? ((A.sha256 = A), (A.sha224 = L), (module.exports = A))
          : I && ((I.sha256 = A), (I.sha224 = L));
      })(this);
    </script>
  </body>
</html>
