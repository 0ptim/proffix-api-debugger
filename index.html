<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Proffix API Debugger</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style type="text/tailwindcss">
      @theme {
        --font-sans: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        --font-mono:
          "JetBrains Mono", "Fira Code", "Consolas", ui-monospace, monospace;
      }

      @keyframes pulse-dot {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.4;
        }
      }

      .dot.pulse {
        animation: pulse-dot 1.2s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .spinner {
        width: 16px;
        height: 16px;
        border: 2.5px solid rgba(255, 255, 255, 0.45);
        border-top-color: #fff;
        border-radius: 50%;
        animation: spin 0.6s linear infinite;
        display: block;
        box-sizing: border-box;
      }

      @keyframes modal-in {
        from {
          opacity: 0;
          transform: translateY(10px) scale(0.98);
        }
        to {
          opacity: 1;
          transform: none;
        }
      }

      .method-dropdown,
      .body-editor,
      .modal-overlay,
      .log-body,
      .log-tab-content {
        display: none;
      }

      .method-dropdown.show,
      .body-editor.show,
      .modal-overlay.show,
      .log-tab-content.active {
        display: block;
      }

      .modal-overlay.show {
        display: flex;
      }

      .log-entry.expanded .log-body {
        display: block;
      }

      .method-btn .method-chevron,
      .log-chevron {
        transition: transform 150ms ease;
      }

      .method-btn.open .method-chevron,
      .log-entry.expanded .log-chevron {
        transform: rotate(180deg);
      }

      .log-tab.active {
        border-bottom-color: #5b6aff;
        color: #5b6aff;
      }

      .copy-btn.copied {
        border-color: rgba(52, 211, 153, 0.2);
        color: #34d399;
      }

      .log-code {
        font-family:
          "Berkeley Mono", "JetBrains Mono", "Cascadia Code", "Fira Code",
          "Consolas", ui-monospace, SFMono-Regular, Menlo, Monaco, monospace;
      }

      .log-json-lines {
        margin: 0;
        display: grid;
        gap: 0;
      }

      .log-json-line {
        display: grid;
        grid-template-columns: 3ch minmax(0, 1fr);
        column-gap: 14px;
      }

      .log-json-lno {
        user-select: none;
        text-align: right;
        color: rgba(139, 143, 168, 0.45);
        font-size: 0.76rem;
      }

      .log-json-code {
        min-width: 0;
        color: #9aa0bc;
      }

      .form-group.has-success .form-input,
      .form-group.has-success .form-select {
        border-color: #34d399;
      }

      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: transparent;
      }

      ::-webkit-scrollbar-thumb {
        background: #2a2d3e;
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #5a5e78;
      }
    </style>
  </head>
  <body
    class="min-h-screen overflow-y-scroll bg-[#0f1117] font-sans text-[15px] leading-relaxed text-[#e4e6f0] antialiased [scrollbar-gutter:stable]"
  >
    <div class="app mx-auto max-w-[960px] px-5">
      <!-- Header -->
      <header
        class="header sticky top-0 z-[100] mb-6 flex flex-wrap items-center justify-between gap-2 border-b border-[#2a2d3e] bg-[#0f1117] py-4 sm:flex-nowrap sm:gap-0"
      >
        <a
          class="header-brand flex items-center gap-2.5 text-[1.1rem] font-bold tracking-[-0.02em] text-[#e4e6f0] no-underline"
          href=""
        >
          <i class="bi bi-fire text-[18px] leading-none" aria-hidden="true"></i>
          Proffix API Debugger
        </a>
        <div
          class="status-bar order-3 mt-1 flex min-w-0 w-full flex-nowrap items-center gap-3 overflow-x-auto sm:order-none sm:mt-0 sm:mr-3 sm:ml-auto sm:w-auto"
        >
          <!-- Connection states -->
          <div
            class="status-pill status-pill-btn inline-flex shrink-0 cursor-pointer select-none items-center gap-[7px] whitespace-nowrap rounded-full border border-[#2a2d3e] bg-[#161822] px-3.5 py-1.5 text-[0.8rem] font-medium transition hover:border-[#5b6aff] hover:bg-[rgba(91,106,255,0.12)]"
            id="lblConnectionNot"
          >
            <span
              class="dot h-[7px] w-[7px] shrink-0 rounded-full bg-[#f87171] shadow-[0_0_6px_#f87171]"
            ></span>
            Not connected
          </div>
          <div
            class="status-pill status-pill-btn hidden shrink-0 cursor-pointer select-none items-center gap-[7px] whitespace-nowrap rounded-full border border-[#2a2d3e] bg-[#161822] px-3.5 py-1.5 text-[0.8rem] font-medium transition hover:border-[#5b6aff] hover:bg-[rgba(91,106,255,0.12)]"
            id="lblConnectionInProgress"
          >
            <span
              class="dot pulse h-[7px] w-[7px] shrink-0 rounded-full bg-[#fbbf24] shadow-[0_0_6px_#fbbf24]"
            ></span>
            Connecting...
          </div>
          <div
            class="status-pill status-pill-btn hidden shrink-0 cursor-pointer select-none items-center gap-[7px] whitespace-nowrap rounded-full border border-[#2a2d3e] bg-[#161822] px-3.5 py-1.5 text-[0.8rem] font-medium transition hover:border-[#5b6aff] hover:bg-[rgba(91,106,255,0.12)]"
            id="lblConnectionOk"
          >
            <span
              class="dot h-[7px] w-[7px] shrink-0 rounded-full bg-[#34d399] shadow-[0_0_6px_#34d399]"
            ></span>
            API <span id="lblRestApiVersion"></span>&nbsp;·&nbsp;<span
              id="lblRestApiUrl"
              style="opacity: 0.7"
            ></span>
          </div>
          <div
            class="status-pill status-pill-btn hidden shrink-0 cursor-pointer select-none items-center gap-[7px] whitespace-nowrap rounded-full border border-[#2a2d3e] bg-[#161822] px-3.5 py-1.5 text-[0.8rem] font-medium transition hover:border-[#5b6aff] hover:bg-[rgba(91,106,255,0.12)]"
            id="lblConnectionFailed"
          >
            <span
              class="dot h-[7px] w-[7px] shrink-0 rounded-full bg-[#f87171] shadow-[0_0_6px_#f87171]"
            ></span>
            Connection failed
          </div>

          <!-- Login states -->
          <div
            class="status-pill status-pill-btn hidden shrink-0 cursor-pointer select-none items-center gap-[7px] whitespace-nowrap rounded-full border border-[#2a2d3e] bg-[#161822] px-3.5 py-1.5 text-[0.8rem] font-medium transition hover:border-[#5b6aff] hover:bg-[rgba(91,106,255,0.12)]"
            id="lblLoginNot"
          >
            <span
              class="dot h-[7px] w-[7px] shrink-0 rounded-full bg-[#f87171] shadow-[0_0_6px_#f87171]"
            ></span>
            Not logged in
          </div>
          <div
            class="status-pill status-pill-btn hidden shrink-0 cursor-pointer select-none items-center gap-[7px] whitespace-nowrap rounded-full border border-[#2a2d3e] bg-[#161822] px-3.5 py-1.5 text-[0.8rem] font-medium transition hover:border-[#5b6aff] hover:bg-[rgba(91,106,255,0.12)]"
            id="lblLoginInProgress"
          >
            <span
              class="dot pulse h-[7px] w-[7px] shrink-0 rounded-full bg-[#fbbf24] shadow-[0_0_6px_#fbbf24]"
            ></span>
            Logging in...
          </div>
          <div
            class="status-pill status-pill-btn hidden shrink-0 cursor-pointer select-none items-center gap-[7px] whitespace-nowrap rounded-full border border-[#2a2d3e] bg-[#161822] px-3.5 py-1.5 text-[0.8rem] font-medium transition hover:border-[#5b6aff] hover:bg-[rgba(91,106,255,0.12)]"
            id="lblLoginOk"
          >
            <span
              class="dot h-[7px] w-[7px] shrink-0 rounded-full bg-[#34d399] shadow-[0_0_6px_#34d399]"
            ></span>
            <span id="lblUsername"></span>
          </div>
          <div
            class="status-pill status-pill-btn hidden shrink-0 cursor-pointer select-none items-center gap-[7px] whitespace-nowrap rounded-full border border-[#2a2d3e] bg-[#161822] px-3.5 py-1.5 text-[0.8rem] font-medium transition hover:border-[#5b6aff] hover:bg-[rgba(91,106,255,0.12)]"
            id="lblLoginFailed"
          >
            <span
              class="dot h-[7px] w-[7px] shrink-0 rounded-full bg-[#f87171] shadow-[0_0_6px_#f87171]"
            ></span>
            Login failed
          </div>
        </div>
        <div class="header-actions flex shrink-0 items-center gap-2">
          <button
            type="button"
            class="btn-icon hidden h-[30px] w-[30px] items-center justify-center rounded-md border border-[#2a2d3e] bg-[#161822] p-1.5 text-[#8b8fa8] transition hover:border-[rgba(248,113,113,0.2)] hover:bg-[rgba(248,113,113,0.08)] hover:text-[#f87171]"
            id="btnLogout"
            title="Logout"
            aria-label="Logout"
          >
            <i
              class="bi bi-box-arrow-right text-[14px] leading-none"
              aria-hidden="true"
            ></i>
          </button>
        </div>
      </header>

      <!-- Session Timeout Banner -->
      <div
        class="timeout-banner hidden mb-4 items-center gap-2.5 rounded-[10px] border border-amber-400/20 bg-[rgba(251,191,36,0.08)] px-4 py-2.5 text-[0.85rem] text-amber-400"
        id="lblLoginTimeout"
      >
        <i
          class="bi bi-exclamation-circle text-[16px] leading-none"
          aria-hidden="true"
        ></i>
        Session expired
        <button
          type="button"
          class="btn btn-sm inline-flex items-center gap-1.5 whitespace-nowrap rounded-md border border-[#2a2d3e] bg-[#161822] px-2.5 py-[5px] text-[0.78rem] leading-[1.4] font-medium text-[#e4e6f0] transition duration-150 hover:border-[#5a5e78] hover:bg-[#1c1f2e] active:scale-95 disabled:pointer-events-none disabled:opacity-40"
          id="btnRelogin"
        >
          Log in again
        </button>
      </div>

      <!-- Request Builder -->
      <div
        class="request-builder mb-6 rounded-[14px] border border-[#2a2d3e] bg-[#161822] p-1"
      >
        <form id="requestform">
          <div class="request-row flex flex-wrap items-center sm:flex-nowrap">
            <div class="method-selector relative">
              <button
                type="button"
                class="method-btn flex items-center gap-1.5 whitespace-nowrap rounded-[10px] bg-transparent px-3.5 py-2.5 font-mono text-[0.85rem] font-semibold tracking-[0.02em] text-emerald-400 transition duration-150 hover:bg-[#1c1f2e]"
                id="btnHttpMethod"
                data-method="GET"
              >
                <span class="method-text">GET</span>
                <i
                  class="method-chevron bi bi-chevron-down text-[12px] leading-none"
                  aria-hidden="true"
                ></i>
              </button>
              <div
                class="method-dropdown absolute left-0 top-[calc(100%+4px)] z-[200] min-w-[170px] rounded-[10px] border border-[#2a2d3e] bg-[#232639] p-1 shadow-2xl"
                id="lstHttpMethods"
              >
                <button
                  type="button"
                  class="method-option flex w-full items-center gap-2.5 rounded-md bg-transparent px-3 py-2 text-left font-mono text-[0.85rem] font-medium text-[#e4e6f0] transition hover:bg-[#1c1f2e]"
                  data-method="GET"
                >
                  <span class="method-name text-emerald-400">GET</span
                  ><span
                    class="method-label ml-auto font-sans text-[0.78rem] font-normal text-[#5a5e78]"
                    >fetch</span
                  >
                </button>
                <button
                  type="button"
                  class="method-option flex w-full items-center gap-2.5 rounded-md bg-transparent px-3 py-2 text-left font-mono text-[0.85rem] font-medium text-[#e4e6f0] transition hover:bg-[#1c1f2e]"
                  data-method="POST"
                >
                  <span class="method-name text-amber-400">POST</span
                  ><span
                    class="method-label ml-auto font-sans text-[0.78rem] font-normal text-[#5a5e78]"
                    >create</span
                  >
                </button>
                <button
                  type="button"
                  class="method-option flex w-full items-center gap-2.5 rounded-md bg-transparent px-3 py-2 text-left font-mono text-[0.85rem] font-medium text-[#e4e6f0] transition hover:bg-[#1c1f2e]"
                  data-method="PUT"
                >
                  <span class="method-name text-orange-400">PUT</span
                  ><span
                    class="method-label ml-auto font-sans text-[0.78rem] font-normal text-[#5a5e78]"
                    >replace</span
                  >
                </button>
                <button
                  type="button"
                  class="method-option flex w-full items-center gap-2.5 rounded-md bg-transparent px-3 py-2 text-left font-mono text-[0.85rem] font-medium text-[#e4e6f0] transition hover:bg-[#1c1f2e]"
                  data-method="PATCH"
                >
                  <span class="method-name text-violet-400">PATCH</span
                  ><span
                    class="method-label ml-auto font-sans text-[0.78rem] font-normal text-[#5a5e78]"
                    >update</span
                  >
                </button>
                <button
                  type="button"
                  class="method-option flex w-full items-center gap-2.5 rounded-md bg-transparent px-3 py-2 text-left font-mono text-[0.85rem] font-medium text-[#e4e6f0] transition hover:bg-[#1c1f2e]"
                  data-method="DELETE"
                >
                  <span class="method-name text-rose-400">DELETE</span
                  ><span
                    class="method-label ml-auto font-sans text-[0.78rem] font-normal text-[#5a5e78]"
                    >delete</span
                  >
                </button>
              </div>
            </div>
            <input
              type="text"
              class="endpoint-input min-w-full flex-1 border-none bg-transparent px-3 py-2.5 font-mono text-[0.9rem] text-[#e4e6f0] outline-none placeholder:text-[#5a5e78] sm:min-w-0"
              id="txtEndpoint"
              placeholder="e.g. ADR/Address/1"
              autocomplete="off"
              spellcheck="false"
            />
            <button
              type="submit"
              class="send-btn relative m-0.5 inline-flex h-10 w-10 shrink-0 items-center justify-center rounded-[10px] border-none bg-[#5b6aff] p-0 text-white leading-none transition duration-150 hover:bg-[#4a58e0] active:scale-95 disabled:cursor-not-allowed disabled:opacity-40"
              id="btnSend"
              disabled
              aria-label="Send (Ctrl+Enter)"
              title="Send (Ctrl+Enter)"
            >
              <span
                class="icon-wrap inline-flex h-4 w-4 items-center justify-center"
                id="iconSend"
                aria-hidden="true"
              >
                <i
                  class="bi bi-send-fill text-[14px] leading-none"
                  aria-hidden="true"
                ></i>
              </span>
              <span
                class="sr-only absolute h-px w-px overflow-hidden whitespace-nowrap border-0 p-0 [clip:rect(0,0,0,0)] [-m-px]"
                >Send</span
              >
              <span class="shortcut hidden">Ctrl+↵</span>
            </button>
          </div>
          <div class="body-editor px-1 pb-1 pt-2" id="httpbody">
            <textarea
              class="body-textarea min-h-[180px] w-full resize-y rounded-[10px] border border-[#2a2d3e] bg-[#1a1d2e] p-3.5 font-mono text-[0.85rem] leading-relaxed text-[#e4e6f0] outline-none transition placeholder:text-[#5a5e78] focus:border-[#5b6aff]"
              id="txtHttpBody"
              placeholder='{ "key": "value" }'
              spellcheck="false"
            ></textarea>
            <div
              class="body-error hidden px-2 pt-1.5 text-[0.8rem] text-[#f87171]"
              id="lblHttpBodyError"
            ></div>
          </div>
        </form>
      </div>

      <!-- Log Section -->
      <div class="section-header mb-4 flex items-center justify-between">
        <div>
          <span
            class="section-title text-[0.8rem] font-semibold tracking-[0.08em] text-[#5a5e78] uppercase"
            >Response Log</span
          >
          <span
            class="log-count hidden ml-2 h-5 min-w-5 items-center justify-center rounded-full bg-[#1c1f2e] px-1.5 text-[0.72rem] font-semibold text-[#8b8fa8]"
            id="logCount"
            >0</span
          >
        </div>
        <button
          type="button"
          class="btn btn-ghost btn-sm inline-flex items-center gap-1.5 whitespace-nowrap rounded-md border border-transparent bg-transparent px-2.5 py-[5px] text-[0.78rem] leading-[1.4] font-medium text-[#8b8fa8] transition duration-150 hover:bg-[#1c1f2e] hover:text-[#e4e6f0] active:scale-95"
          id="btnLogClear"
        >
          <i
            class="bi bi-trash3 text-[13px] leading-none"
            aria-hidden="true"
          ></i>
          Clear
        </button>
      </div>

      <div id="output">
        <div
          class="log-empty px-5 py-12 text-center text-[0.9rem] text-[#5a5e78]"
          id="logEmpty"
        >
          <i
            class="bi bi-inbox mb-3 block text-[40px] leading-none opacity-30"
            aria-hidden="true"
          ></i>
          <div>No requests sent yet</div>
        </div>
      </div>

      <div style="height: 60px"></div>
    </div>

    <!-- Connection Settings Modal -->
    <div
      class="modal-overlay fixed inset-0 z-[1000] items-center justify-center bg-black/60 p-5 [backdrop-filter:blur(4px)]"
      id="modalConnectionSettings"
    >
      <div
        class="modal w-full max-w-[480px] rounded-[14px] border border-[#2a2d3e] bg-[#161822] shadow-2xl [animation:modal-in_200ms_ease]"
      >
        <div
          class="modal-header flex items-center justify-between border-b border-[#2a2d3e] px-[22px] py-[18px]"
        >
          <h3 class="modal-title text-base font-semibold">
            Connection settings
          </h3>
          <button
            type="button"
            class="modal-close flex cursor-pointer rounded-md bg-transparent p-1 text-[#5a5e78] transition hover:bg-[#1c1f2e] hover:text-[#e4e6f0]"
            data-dismiss="modal"
          >
            <i
              class="bi bi-x-lg text-[16px] leading-none"
              aria-hidden="true"
            ></i>
          </button>
        </div>
        <div class="modal-body p-[22px]">
          <div class="form-group mb-4 last:mb-0">
            <label
              class="form-label mb-1.5 block text-[0.8rem] font-medium text-[#8b8fa8]"
              for="txtConnSettRestApiUrl"
              >REST API URL</label
            >
            <input
              type="url"
              class="form-input w-full rounded-md border border-[#2a2d3e] bg-[#1a1d2e] px-3 py-[9px] text-[0.85rem] text-[#e4e6f0] outline-none transition placeholder:text-[#5a5e78] focus:border-[#5b6aff]"
              id="txtConnSettRestApiUrl"
              placeholder="https://remote.proffix.net:11011/pxapi/v4"
            />
            <div class="form-hint mt-1 text-[0.75rem] text-[#5a5e78]">
              e.g. https://remote.proffix.net:11011/pxapi/v4
            </div>
          </div>
          <div class="form-group mb-4 last:mb-0">
            <label
              class="form-label mb-1.5 block text-[0.8rem] font-medium text-[#8b8fa8]"
              for="txtConnSettRestApiPwd"
              >Password (plain text)</label
            >
            <input
              type="password"
              class="form-input w-full rounded-md border border-[#2a2d3e] bg-[#1a1d2e] px-3 py-[9px] text-[0.85rem] text-[#e4e6f0] outline-none transition placeholder:text-[#5a5e78] focus:border-[#5b6aff]"
              id="txtConnSettRestApiPwd"
              placeholder="Will be hashed automatically"
            />
          </div>
          <div class="form-group mb-4 last:mb-0">
            <label
              class="form-label mb-1.5 block text-[0.8rem] font-medium text-[#8b8fa8]"
              for="txtConnSettRestApiPwdHash"
              >Password (SHA-256 hash)</label
            >
            <input
              type="password"
              class="form-input w-full rounded-md border border-[#2a2d3e] bg-[#1a1d2e] px-3 py-[9px] text-[0.85rem] text-[#e4e6f0] outline-none transition placeholder:text-[#5a5e78] focus:border-[#5b6aff]"
              id="txtConnSettRestApiPwdHash"
              placeholder="Alternative: already hashed password"
            />
          </div>
        </div>
        <div
          class="modal-footer flex items-center justify-end gap-2 border-t border-[#2a2d3e] px-[22px] py-4"
        >
          <button
            type="button"
            class="btn inline-flex items-center gap-1.5 whitespace-nowrap rounded-md border border-[#2a2d3e] bg-[#161822] px-4 py-2 text-[0.85rem] leading-[1.4] font-medium text-[#e4e6f0] transition duration-150 hover:border-[#5a5e78] hover:bg-[#1c1f2e] active:scale-95"
            data-dismiss="modal"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary inline-flex items-center gap-1.5 whitespace-nowrap rounded-md border border-[#5b6aff] bg-[#5b6aff] px-4 py-2 text-[0.85rem] leading-[1.4] font-medium text-white transition duration-150 hover:border-[#4a58e0] hover:bg-[#4a58e0] active:scale-95"
            id="btnConnect"
          >
            <i
              class="bi bi-plug text-[13px] leading-none"
              aria-hidden="true"
            ></i>
            Connect
          </button>
        </div>
      </div>
    </div>

    <!-- Login Modal -->
    <div
      class="modal-overlay fixed inset-0 z-[1000] items-center justify-center bg-black/60 p-5 [backdrop-filter:blur(4px)]"
      id="modalLogin"
    >
      <div
        class="modal w-full max-w-[480px] rounded-[14px] border border-[#2a2d3e] bg-[#161822] shadow-2xl [animation:modal-in_200ms_ease]"
      >
        <div
          class="modal-header flex items-center justify-between border-b border-[#2a2d3e] px-[22px] py-[18px]"
        >
          <h3 class="modal-title text-base font-semibold">Login</h3>
          <button
            type="button"
            class="modal-close flex cursor-pointer rounded-md bg-transparent p-1 text-[#5a5e78] transition hover:bg-[#1c1f2e] hover:text-[#e4e6f0]"
            data-dismiss="modal"
          >
            <i
              class="bi bi-x-lg text-[16px] leading-none"
              aria-hidden="true"
            ></i>
          </button>
        </div>
        <div class="modal-body p-[22px]">
          <div class="form-group mb-4 last:mb-0">
            <label
              class="form-label mb-1.5 block text-[0.8rem] font-medium text-[#8b8fa8]"
              for="selDatabase"
              >Database</label
            >
            <select
              class="form-select w-full rounded-md border border-[#2a2d3e] bg-[#1a1d2e] px-3 py-[9px] text-[0.85rem] text-[#e4e6f0] outline-none transition focus:border-[#5b6aff]"
              id="selDatabase"
            ></select>
            <div class="form-hint mt-1 text-[0.75rem] text-[#5a5e78]">
              Log out before switching.
            </div>
          </div>
          <div class="form-group mb-4 last:mb-0">
            <label
              class="form-label mb-1.5 block text-[0.8rem] font-medium text-[#8b8fa8]"
              for="txtLoginUsername"
              >Username</label
            >
            <input
              type="text"
              class="form-input w-full rounded-md border border-[#2a2d3e] bg-[#1a1d2e] px-3 py-[9px] text-[0.85rem] text-[#e4e6f0] outline-none transition placeholder:text-[#5a5e78] focus:border-[#5b6aff]"
              id="txtLoginUsername"
              autocomplete="username"
            />
          </div>
          <div class="form-group mb-4 last:mb-0">
            <label
              class="form-label mb-1.5 block text-[0.8rem] font-medium text-[#8b8fa8]"
              for="txtLoginPwd"
              >Password (plain text)</label
            >
            <input
              type="password"
              class="form-input w-full rounded-md border border-[#2a2d3e] bg-[#1a1d2e] px-3 py-[9px] text-[0.85rem] text-[#e4e6f0] outline-none transition placeholder:text-[#5a5e78] focus:border-[#5b6aff]"
              id="txtLoginPwd"
              autocomplete="current-password"
            />
          </div>
          <div class="form-group mb-4 last:mb-0">
            <label
              class="form-label mb-1.5 block text-[0.8rem] font-medium text-[#8b8fa8]"
              for="txtLoginPwdHash"
              >Password (SHA-256 hash)</label
            >
            <input
              type="password"
              class="form-input w-full rounded-md border border-[#2a2d3e] bg-[#1a1d2e] px-3 py-[9px] text-[0.85rem] text-[#e4e6f0] outline-none transition placeholder:text-[#5a5e78] focus:border-[#5b6aff]"
              id="txtLoginPwdHash"
            />
          </div>
        </div>
        <div
          class="modal-footer flex items-center justify-end gap-2 border-t border-[#2a2d3e] px-[22px] py-4"
        >
          <button
            type="button"
            class="btn inline-flex items-center gap-1.5 whitespace-nowrap rounded-md border border-[#2a2d3e] bg-[#161822] px-4 py-2 text-[0.85rem] leading-[1.4] font-medium text-[#e4e6f0] transition duration-150 hover:border-[#5a5e78] hover:bg-[#1c1f2e] active:scale-95"
            data-dismiss="modal"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary inline-flex items-center gap-1.5 whitespace-nowrap rounded-md border border-[#5b6aff] bg-[#5b6aff] px-4 py-2 text-[0.85rem] leading-[1.4] font-medium text-white transition duration-150 hover:border-[#4a58e0] hover:bg-[#4a58e0] active:scale-95"
            id="btnLogin"
          >
            <i
              class="bi bi-box-arrow-in-right text-[13px] leading-none"
              aria-hidden="true"
            ></i>
            Login
          </button>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
      "use strict";

      // ═══════════════════════════════════════════════
      // State
      // ═══════════════════════════════════════════════
      var loginObject = null;
      var connectionSettings = null;
      var pxSessionId;
      var noOfRequests = 0;
      var wasLoggedIn = false;
      var selectedHttpMethod = "GET";
      var logcounter = 0;

      var displayClassById = {
        lblConnectionNot: "inline-flex",
        lblConnectionInProgress: "inline-flex",
        lblConnectionOk: "inline-flex",
        lblConnectionFailed: "inline-flex",
        lblLoginNot: "inline-flex",
        lblLoginInProgress: "inline-flex",
        lblLoginOk: "inline-flex",
        lblLoginFailed: "inline-flex",
        btnLogout: "inline-flex",
        lblLoginTimeout: "flex",
        logCount: "inline-flex",
      };

      function setElementVisibilityById(id, isVisible) {
        var element = $("#" + id);
        var displayClass = displayClassById[id];
        if (isVisible) {
          element.removeClass("hidden");
          if (displayClass) element.addClass(displayClass);
        } else {
          element.addClass("hidden");
          if (displayClass) element.removeClass(displayClass);
        }
      }

      // ═══════════════════════════════════════════════
      // Custom modal show/hide (replaces Bootstrap modals)
      // ═══════════════════════════════════════════════
      function showModal(id) {
        var el = document.getElementById(id);
        if (el) {
          el.classList.add("show");
        }
      }
      function hideModal(id) {
        var el = document.getElementById(id);
        if (el) {
          el.classList.remove("show");
        }
      }
      // Close on overlay click or dismiss buttons
      $(document).on("click", ".modal-overlay", function (e) {
        if (e.target === this) $(this).removeClass("show");
      });
      $(document).on("click", "[data-dismiss='modal']", function () {
        $(this).closest(".modal-overlay").removeClass("show");
      });
      // Esc to close
      $(document).on("keydown", function (e) {
        if (e.key === "Escape") $(".modal-overlay.show").removeClass("show");
      });

      // ═══════════════════════════════════════════════
      // API Call
      // ═══════════════════════════════════════════════
      var doApiCall = function (method, endpoint, success, error, data) {
        noOfRequests++;
        updateSendButton();

        var starttime = Date.now();
        $.ajax({
          url:
            connectionSettings.url +
            "/" +
            endpoint
              .replace(/^\/+/g, "")
              .replace(/([pP][xX][aA][pP][iI]\/v[0-9]|v[0-9])/g, "")
              .replace(/^\/+/g, ""),
          method: method,
          headers: {
            "Content-Type": "application/json",
            PxSessionId: pxSessionId,
          },
          data: JSON.stringify(data),
          timeout: 60000,
          success: function (responseObject, status, request) {
            var endtime = Date.now();
            pxSessionId = request.getResponseHeader("PxSessionId");
            var responseArrayCount = Array.isArray(responseObject)
              ? responseObject.length
              : null;
            writeLog(
              method.toUpperCase(),
              endpoint,
              request.status,
              request.statusText,
              responseObject ? JSON.stringify(responseObject, null, 2) : "",
              data ? JSON.stringify(data, null, 2) : "",
              endtime - starttime,
              method == "POST" ? request.getResponseHeader("Location") : null,
              responseArrayCount,
            );
            decreaseNoOfRequests();
            setElementVisibilityById("lblLoginTimeout", false);
            if (success != undefined) success(responseObject, status);
          },
          error: function (request) {
            var endtime = Date.now();
            pxSessionId = request.getResponseHeader("PxSessionId");
            if (wasLoggedIn && request.status === 401) {
              setElementVisibilityById("lblLoginTimeout", true);
            }
            var responseTextForLog = request.responseText || "";
            var parsedResponseForLog = request.responseJSON;
            if (responseTextForLog.length > 0) {
              try {
                if (!parsedResponseForLog) {
                  parsedResponseForLog = JSON.parse(responseTextForLog);
                }
                responseTextForLog = JSON.stringify(
                  parsedResponseForLog,
                  null,
                  2,
                );
              } catch (e) {}
            }
            writeLog(
              method.toUpperCase(),
              endpoint,
              request.status,
              request.statusText,
              responseTextForLog,
              data ? JSON.stringify(data, null, 2) : "",
              endtime - starttime,
              null,
              Array.isArray(parsedResponseForLog)
                ? parsedResponseForLog.length
                : null,
            );
            decreaseNoOfRequests();
            if (error != undefined) error(request.responseJSON, request.status);
          },
        });
      };

      // ═══════════════════════════════════════════════
      // Send Button State
      // ═══════════════════════════════════════════════
      var updateSendButton = function () {
        if (noOfRequests > 0) {
          $("#iconSend").html('<span class="spinner"></span>');
        } else {
          $("#iconSend").html(
            '<i class="bi bi-send-fill text-[14px] leading-none" aria-hidden="true"></i>',
          );
        }
      };

      var decreaseNoOfRequests = function () {
        noOfRequests--;
        if (noOfRequests === 0) updateSendButton();
      };

      // ═══════════════════════════════════════════════
      // Field Validation
      // ═══════════════════════════════════════════════
      var fieldValidation = function (inputElem, validationMethod) {
        var formgroup = inputElem.closest("div.form-group");
        formgroup.removeClass("has-success");
        if (validationMethod(inputElem.val())) {
          formgroup.addClass("has-success");
          return true;
        }
        return false;
      };

      // ═══════════════════════════════════════════════
      // Syntax Highlighting for JSON
      // ═══════════════════════════════════════════════
      function syntaxHighlight(json) {
        if (!json) return "";
        json = json
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
        return json.replace(
          /("(\\u[\da-fA-F]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,
          function (match) {
            var cls = "color:#a78bfa"; // number
            if (/^"/.test(match)) {
              if (/:$/.test(match)) {
                cls = "color:#60a5fa"; // key
              } else {
                cls = "color:#34d399"; // string
              }
            } else if (/true|false/.test(match)) {
              cls = "color:#fbbf24"; // boolean
            } else if (/null/.test(match)) {
              cls = "color:#f87171"; // null
            }
            return '<span style="' + cls + '">' + match + "</span>";
          },
        );
      }

      function renderWithLineNumbers(rendered) {
        var value = rendered || "";
        var lines = String(value).split("\n");
        return (
          '<div class="log-json-lines">' +
          lines
            .map(function (line, index) {
              return (
                '<div class="log-json-line">' +
                '<span class="log-json-lno">' +
                (index + 1) +
                "</span>" +
                '<span class="log-json-code">' +
                (line.length ? line : "&nbsp;") +
                "</span>" +
                "</div>"
              );
            })
            .join("") +
          "</div>"
        );
      }

      function getMethodColorClass(method) {
        var methodColors = {
          GET: "text-emerald-400",
          POST: "text-amber-400",
          PUT: "text-orange-400",
          PATCH: "text-violet-400",
          DELETE: "text-rose-400",
        };
        return (
          methodColors[String(method || "").toUpperCase()] || "text-sky-400"
        );
      }

      function getMethodBadgeClass(method) {
        var badgeColors = {
          GET: "bg-emerald-400/10 text-emerald-400",
          POST: "bg-amber-400/10 text-amber-400",
          PUT: "bg-orange-400/10 text-orange-400",
          PATCH: "bg-violet-400/10 text-violet-400",
          DELETE: "bg-rose-400/10 text-rose-400",
        };
        return (
          badgeColors[String(method || "").toUpperCase()] ||
          "bg-sky-400/10 text-sky-400"
        );
      }

      // ═══════════════════════════════════════════════
      // Write Log Entry
      // ═══════════════════════════════════════════════
      var writeLog = function (
        method,
        endpoint,
        statuscode,
        statuscodetext,
        response,
        request,
        duration,
        locationHeader,
        responseArrayCount,
      ) {
        logcounter++;
        $("#logEmpty").addClass("hidden");

        var isSuccess = statuscode >= 200 && statuscode < 300;
        var statusClass = isSuccess
          ? "bg-emerald-400/10 text-emerald-400"
          : "bg-rose-400/10 text-rose-400";
        var entryClass = isSuccess
          ? "border-l-[3px] border-l-emerald-400"
          : "border-l-[3px] border-l-rose-400";
        var hoverLeftClass = isSuccess
          ? "hover:border-l-emerald-400"
          : "hover:border-l-rose-400";
        var methodBadgeClass = getMethodBadgeClass(method);
        var now = new Date();
        var timeStr = now.toLocaleTimeString("en-CH", {
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        });

        // Build location HTML
        var locationHtml = "";
        if (locationHeader) {
          if (locationHeader.includes("/PRO/Datei/")) {
            locationHtml =
              '<div class="log-location border-b border-[#2a2d3e] px-4 py-2.5 text-[0.8rem]"><span style="color:#8b8fa8">Location:</span> <a class="text-[#5b6aff] no-underline hover:underline" href="' +
              locationHeader +
              "?pxSessionId=" +
              pxSessionId +
              '" target="_blank">' +
              locationHeader +
              "</a></div>";
          } else {
            locationHtml =
              '<div class="log-location border-b border-[#2a2d3e] px-4 py-2.5 text-[0.8rem]"><span style="color:#8b8fa8">Location:</span> ' +
              escapeHtml(locationHeader) +
              "</div>";
          }
        }

        var id = "log-" + logcounter;
        var highlightedResponse = response
          ? renderWithLineNumbers(syntaxHighlight(response))
          : '<span style="color:#8b8fa8">— leer —</span>';
        var highlightedRequest = request
          ? renderWithLineNumbers(syntaxHighlight(request))
          : '<span style="color:#8b8fa8">— leer —</span>';
        var arrayCountBadge =
          typeof responseArrayCount === "number"
            ? '<span class="log-tab-count ml-1 inline-flex h-4 min-w-4 items-center justify-center rounded-full border border-sky-400/25 bg-sky-400/12 px-1.5 align-middle font-mono text-[0.68rem] leading-none font-semibold text-sky-400" title="Top-level array length: ' +
              responseArrayCount +
              '">' +
              responseArrayCount +
              "</span>"
            : "";
        var responseTabLabel = "Response" + arrayCountBadge;
        var endpointDisplay = getEndpointDisplay(endpoint);

        var entry = $(
          '<div class="log-entry ' +
            "mb-2.5 overflow-hidden rounded-[10px] border border-[#2a2d3e] bg-[#161822] transition duration-150 hover:border-[#5a5e78] " +
            hoverLeftClass +
            " " +
            entryClass +
            ' expanded" data-id="' +
            id +
            '">' +
            '<div class="log-header flex cursor-pointer select-none items-center gap-2.5 px-4 py-3">' +
            '<span class="log-method ' +
            "rounded px-2 py-0.5 font-mono text-[0.78rem] font-bold tracking-[0.03em] " +
            methodBadgeClass +
            '">' +
            method +
            "</span>" +
            '<span class="log-endpoint min-w-0 flex-1 overflow-hidden text-ellipsis whitespace-nowrap font-mono text-[0.85rem] text-[#e4e6f0]">' +
            escapeHtml(endpointDisplay) +
            "</span>" +
            '<div class="log-meta flex shrink-0 items-center gap-2 sm:gap-3">' +
            '<span class="log-status ' +
            "rounded px-2 py-0.5 font-mono text-[0.78rem] font-semibold " +
            statusClass +
            '">' +
            statuscode +
            " " +
            statuscodetext +
            "</span>" +
            '<span class="log-duration hidden min-w-[50px] text-right font-mono text-[0.75rem] text-[#5a5e78] sm:inline">' +
            duration +
            "ms</span>" +
            '<span class="log-time text-[0.72rem] text-[#5a5e78]">' +
            timeStr +
            "</span>" +
            '<button type="button" class="log-delete-btn inline-flex h-5 w-5 items-center justify-center rounded bg-transparent text-[#5a5e78] transition hover:bg-rose-400/12 hover:text-rose-400" title="Delete entry" aria-label="Delete entry"><i class="bi bi-x-lg text-[11px] leading-none" aria-hidden="true"></i></button>' +
            '<i class="log-chevron bi bi-chevron-down shrink-0 text-[#5a5e78] text-[12px] leading-none" aria-hidden="true"></i>' +
            "</div>" +
            "</div>" +
            '<div class="log-body border-t border-[#2a2d3e]">' +
            locationHtml +
            '<div class="log-tabs flex border-b border-[#2a2d3e]">' +
            '<button type="button" class="log-tab active cursor-pointer border-b-2 border-transparent bg-transparent px-4 py-2 text-[0.8rem] font-medium text-[#5a5e78] transition hover:text-[#8b8fa8]" data-tab="response-' +
            id +
            '">' +
            responseTabLabel +
            "</button>" +
            '<button type="button" class="log-tab cursor-pointer border-b-2 border-transparent bg-transparent px-4 py-2 text-[0.8rem] font-medium text-[#5a5e78] transition hover:text-[#8b8fa8]" data-tab="request-' +
            id +
            '">Request</button>' +
            "</div>" +
            '<div class="log-tab-content active" id="response-' +
            id +
            '">' +
            '<div class="log-code-wrap relative">' +
            '<button type="button" class="copy-btn absolute right-2 top-2 z-[5] cursor-pointer rounded-md border border-[#2a2d3e] bg-[#232639] px-2.5 py-1 text-[0.72rem] font-medium text-[#8b8fa8] transition hover:border-[#5a5e78] hover:text-[#e4e6f0]" data-copy="response" data-id="' +
            id +
            '">Copy</button>' +
            '<div class="log-code max-h-[400px] overflow-x-auto overflow-y-auto break-words whitespace-pre-wrap px-4 py-3.5 font-mono text-[0.8rem] leading-[1.7] text-[#8b8fa8]">' +
            highlightedResponse +
            "</div>" +
            "</div>" +
            "</div>" +
            '<div class="log-tab-content" id="request-' +
            id +
            '">' +
            '<div class="log-code-wrap relative">' +
            '<button type="button" class="copy-btn absolute right-2 top-2 z-[5] cursor-pointer rounded-md border border-[#2a2d3e] bg-[#232639] px-2.5 py-1 text-[0.72rem] font-medium text-[#8b8fa8] transition hover:border-[#5a5e78] hover:text-[#e4e6f0]" data-copy="request" data-id="' +
            id +
            '">Copy</button>' +
            '<div class="log-code max-h-[400px] overflow-x-auto overflow-y-auto break-words whitespace-pre-wrap px-4 py-3.5 font-mono text-[0.8rem] leading-[1.7] text-[#8b8fa8]">' +
            highlightedRequest +
            "</div>" +
            "</div>" +
            "</div>" +
            "</div>" +
            "</div>",
        );

        // Store raw data for copy
        entry.data("response", response || "");
        entry.data("request", request || "");

        $("#output").prepend(entry);
        updateLogCount();
      };

      function updateLogCount() {
        var count = $("#output .log-entry").length;
        if (count > 0) {
          $("#logCount").text(count);
          setElementVisibilityById("logCount", true);
        } else {
          setElementVisibilityById("logCount", false);
        }
      }

      function escapeHtml(str) {
        if (!str) return "";
        return str
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;");
      }

      function getApiHostDisplay(url) {
        if (!url) return "";
        try {
          return new URL(url).host;
        } catch (e) {
          return url.replace(/^[a-z]+:\/\//i, "").split("/")[0];
        }
      }

      function getEndpointDisplay(endpoint) {
        if (!endpoint) return "";

        var value = String(endpoint);
        var hashIndex = value.indexOf("#");
        var hash = hashIndex >= 0 ? value.substring(hashIndex) : "";
        var noHash = hashIndex >= 0 ? value.substring(0, hashIndex) : value;

        var queryIndex = noHash.indexOf("?");
        if (queryIndex < 0) return value;

        var path = noHash.substring(0, queryIndex);
        var query = noHash.substring(queryIndex + 1);

        try {
          var params = new URLSearchParams(query);
          var filtered = new URLSearchParams();

          params.forEach(function (paramValue, paramName) {
            if (String(paramName).toLowerCase() !== "key") {
              filtered.append(paramName, paramValue);
            }
          });

          var filteredQuery = filtered.toString();
          return path + (filteredQuery ? "?" + filteredQuery : "") + hash;
        } catch (e) {
          return (
            noHash
              .replace(/([?&])key=[^&#]*&?/gi, "$1")
              .replace(/[?&]$/, "")
              .replace("?&", "?") + hash
          );
        }
      }

      // ═══════════════════════════════════════════════
      // Connect
      // ═══════════════════════════════════════════════
      var doConnect = function () {
        setElementVisibilityById("lblConnectionNot", false);
        setElementVisibilityById("lblConnectionInProgress", true);
        setElementVisibilityById("lblConnectionOk", false);
        setElementVisibilityById("lblConnectionFailed", false);

        doApiCall(
          "GET",
          "PRO/Info?key=" + connectionSettings.pwd,
          function (info) {
            setElementVisibilityById("lblConnectionInProgress", false);
            setElementVisibilityById("lblConnectionOk", true);
            $("#lblRestApiVersion").text(info.Version);
            $("#lblRestApiUrl").text(getApiHostDisplay(connectionSettings.url));
            $("#btnSend").removeAttr("disabled");

            // Show login-not after connected
            if (!wasLoggedIn) {
              setElementVisibilityById("lblLoginNot", true);
            }

            // Load databases
            $("#selDatabase option").remove();
            $("#selDatabase")
              .attr("disabled", "disabled")
              .append("<option>No databases found</option>");
            doApiCall(
              "GET",
              "PRO/Datenbank?key=" + connectionSettings.pwd,
              function (databases) {
                $("#selDatabase option").remove();
                $("#selDatabase").removeAttr("disabled");
                $.each(databases, function (index, database) {
                  $("#selDatabase").append(
                    '<option value="' +
                      database.Name +
                      '">' +
                      database.Bezeichnung +
                      " (" +
                      database.Name +
                      ")</option>",
                  );
                });
                if (
                  loginObject &&
                  loginObject.Datenbank &&
                  loginObject.Datenbank.Name
                ) {
                  $("#selDatabase").val(loginObject.Datenbank.Name);
                }
              },
            );
          },
          function () {
            setElementVisibilityById("lblConnectionInProgress", false);
            setElementVisibilityById("lblConnectionFailed", true);
          },
        );
      };

      // ═══════════════════════════════════════════════
      // Login
      // ═══════════════════════════════════════════════
      var doLogin = function () {
        setElementVisibilityById("lblLoginNot", false);
        setElementVisibilityById("lblLoginInProgress", true);
        setElementVisibilityById("lblLoginOk", false);
        setElementVisibilityById("lblLoginFailed", false);

        doApiCall(
          "POST",
          "PRO/Login",
          function () {
            setElementVisibilityById("lblLoginInProgress", false);
            setElementVisibilityById("lblLoginOk", true);
            setElementVisibilityById("btnLogout", true);
            wasLoggedIn = true;

            doApiCall("GET", "PRO/Login", function (login) {
              $("#lblUsername").text(
                login.Benutzer + " · " + login.Datenbank.Name,
              );
            });
          },
          function () {
            setElementVisibilityById("lblLoginInProgress", false);
            setElementVisibilityById("lblLoginFailed", true);
            wasLoggedIn = false;
          },
          loginObject,
        );
      };

      // ═══════════════════════════════════════════════
      // Set HTTP Method
      // ═══════════════════════════════════════════════
      var setHttpMethod = function (method) {
        selectedHttpMethod = method;
        var btn = document.getElementById("btnHttpMethod");
        btn.setAttribute("data-method", method);
        btn.querySelector(".method-text").textContent = method;
        btn.classList.remove(
          "text-emerald-400",
          "text-amber-400",
          "text-orange-400",
          "text-violet-400",
          "text-rose-400",
          "text-sky-400",
        );
        btn.classList.add(getMethodColorClass(method));

        // Show/hide body editor
        var bodyEditor = document.getElementById("httpbody");
        if (method === "POST" || method === "PUT" || method === "PATCH") {
          bodyEditor.classList.add("show");
        } else {
          bodyEditor.classList.remove("show");
        }
      };

      // ═══════════════════════════════════════════════
      // URL Params
      // ═══════════════════════════════════════════════
      var getUrlParam = function (name) {
        var url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
          results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return "";
        return decodeURIComponent(results[2].replace(/\+/g, " "));
      };

      // ═══════════════════════════════════════════════
      // DOM Ready
      // ═══════════════════════════════════════════════
      $(document).ready(function () {
        // URL params
        var paramUrl = getUrlParam("url");
        var paramPwhash = getUrlParam("pwhash");
        if (paramUrl != null && paramPwhash != null) {
          connectionSettings = {
            url: paramUrl + "/pxapi/v4",
            pwd: paramPwhash,
          };
          $("#txtConnSettRestApiUrl").val(connectionSettings.url);
        }

        // Auto-connect and login
        if (connectionSettings) doConnect();
        if (loginObject) doLogin();

        // ═══════════════════════════════════════════════
        // Events
        // ═══════════════════════════════════════════════

        // Connection settings via status pills
        $(
          "#lblConnectionNot, #lblConnectionInProgress, #lblConnectionOk, #lblConnectionFailed",
        ).click(function () {
          showModal("modalConnectionSettings");
        });

        // Login via status pills
        $(
          "#lblLoginNot, #lblLoginInProgress, #lblLoginOk, #lblLoginFailed",
        ).click(function () {
          showModal("modalLogin");
        });

        // Connect
        $("#btnConnect").click(function () {
          if (
            fieldValidation($("#txtConnSettRestApiUrl"), function (val) {
              return val != "";
            })
          ) {
            let passwordHash;
            const clearTextPassword = $("#txtConnSettRestApiPwd").val();
            if (clearTextPassword) {
              passwordHash = sha256(clearTextPassword).toString();
            } else {
              passwordHash = $("#txtConnSettRestApiPwdHash").val();
            }
            if (passwordHash) {
              connectionSettings = {
                url: $("#txtConnSettRestApiUrl").val(),
                pwd: passwordHash,
              };
              doConnect();
              hideModal("modalConnectionSettings");
            } else {
              alert("Please enter a password or password hash.");
            }
          }
        });

        // Login
        $("#btnLogin").click(function () {
          if (
            fieldValidation($("#selDatabase"), function (val) {
              return val != "";
            }) &&
            fieldValidation($("#txtLoginUsername"), function (val) {
              return val != "";
            })
          ) {
            var modArr = ["VOL"];
            let passwordHash;
            const clearTextPassword = $("#txtLoginPwd").val();
            if (clearTextPassword) {
              passwordHash = sha256(clearTextPassword).toString();
            } else {
              passwordHash = $("#txtLoginPwdHash").val();
            }
            if (passwordHash) {
              loginObject = {
                Benutzer: $("#txtLoginUsername").val(),
                Passwort: passwordHash,
                Module: modArr,
                Datenbank: { Name: $("#selDatabase").val() },
              };
              doLogin();
              hideModal("modalLogin");
            } else {
              alert("Please enter a password or password hash.");
            }
          }
        });

        // Logout
        $("#btnLogout").click(function () {
          doApiCall("DELETE", "PRO/Login");
          setElementVisibilityById("lblLoginInProgress", false);
          setElementVisibilityById("lblLoginOk", false);
          setElementVisibilityById("lblLoginFailed", false);
          setElementVisibilityById("lblLoginTimeout", false);
          setElementVisibilityById("lblLoginNot", true);
          setElementVisibilityById("btnLogout", false);
        });

        // Relogin
        $("#btnRelogin").click(function () {
          doLogin();
        });

        // Clear log
        $("#btnLogClear").click(function () {
          $("#output").empty();
          $("#output").append(
            '<div class="log-empty px-5 py-12 text-center text-[0.9rem] text-[#5a5e78]" id="logEmpty"><i class="bi bi-inbox mb-3 block text-[40px] leading-none opacity-30" aria-hidden="true"></i><div>No requests sent yet</div></div>',
          );
          logcounter = 0;
          updateLogCount();
        });

        // Method dropdown
        $("#btnHttpMethod").click(function (e) {
          e.stopPropagation();
          var dd = $("#lstHttpMethods");
          dd.toggleClass("show");
          $(this).toggleClass("open");
        });

        $(document).click(function () {
          $("#lstHttpMethods").removeClass("show");
          $("#btnHttpMethod").removeClass("open");
        });

        $(".method-option").click(function (e) {
          e.preventDefault();
          e.stopPropagation();
          setHttpMethod($(this).attr("data-method"));
          $("#lstHttpMethods").removeClass("show");
          $("#btnHttpMethod").removeClass("open");
        });

        // Log entry expand/collapse
        $(document).on("click", ".log-header", function () {
          $(this).closest(".log-entry").toggleClass("expanded");
        });

        // Delete single log entry
        $(document).on("click", ".log-delete-btn", function (e) {
          e.stopPropagation();
          $(this).closest(".log-entry").remove();
          if ($("#output .log-entry").length === 0) {
            var empty = $("#logEmpty");
            if (empty.length > 0) {
              empty.removeClass("hidden");
            } else {
              $("#output").append(
                '<div class="log-empty px-5 py-12 text-center text-[0.9rem] text-[#5a5e78]" id="logEmpty"><i class="bi bi-inbox mb-3 block text-[40px] leading-none opacity-30" aria-hidden="true"></i><div>No requests sent yet</div></div>',
              );
            }
          }
          updateLogCount();
        });

        // Log tabs
        $(document).on("click", ".log-tab", function (e) {
          e.stopPropagation();
          var entry = $(this).closest(".log-entry");
          entry.find(".log-tab").removeClass("active");
          entry.find(".log-tab-content").removeClass("active");
          $(this).addClass("active");
          entry.find("#" + $(this).data("tab")).addClass("active");
        });

        // Copy button
        $(document).on("click", ".copy-btn", function (e) {
          e.stopPropagation();
          var btn = $(this);
          var entry = btn.closest(".log-entry");
          var type = btn.data("copy");
          var text = entry.data(type) || "";

          navigator.clipboard.writeText(text).then(function () {
            btn.text("Copied!").addClass("copied");
            setTimeout(function () {
              btn.text("Copy").removeClass("copied");
            }, 1500);
          });
        });

        // JSON body editor: keep focus on Tab and indent/outdent
        $(document).on("keydown", "#txtHttpBody", function (e) {
          if (e.key !== "Tab" || e.ctrlKey || e.metaKey || e.altKey) return;

          e.preventDefault();
          var textarea = this;
          var value = textarea.value;
          var start = textarea.selectionStart;
          var end = textarea.selectionEnd;
          var indent = "  ";
          var hasSelection = start !== end;

          if (!e.shiftKey) {
            if (!hasSelection) {
              textarea.value =
                value.substring(0, start) + indent + value.substring(end);
              textarea.selectionStart = textarea.selectionEnd =
                start + indent.length;
              return;
            }

            var indentLineStart = value.lastIndexOf("\n", start - 1) + 1;
            var indentSelectedText = value.substring(indentLineStart, end);
            var indentLines = indentSelectedText.split("\n");
            var indentedText = indentLines
              .map(function (line) {
                return indent + line;
              })
              .join("\n");

            textarea.value =
              value.substring(0, indentLineStart) +
              indentedText +
              value.substring(end);
            textarea.selectionStart = start + indent.length;
            textarea.selectionEnd = end + indent.length * indentLines.length;
            return;
          }

          var outdentLineStart = value.lastIndexOf("\n", start - 1) + 1;

          if (!hasSelection) {
            var currentLineEnd = value.indexOf("\n", start);
            if (currentLineEnd === -1) currentLineEnd = value.length;
            var currentLine = value.substring(outdentLineStart, currentLineEnd);
            var removeCount = 0;
            if (currentLine.startsWith(indent)) {
              removeCount = indent.length;
            } else if (currentLine.startsWith("\t")) {
              removeCount = 1;
            }
            if (removeCount === 0) return;

            textarea.value =
              value.substring(0, outdentLineStart) +
              currentLine.substring(removeCount) +
              value.substring(currentLineEnd);
            var cursorAdjust = Math.min(removeCount, start - outdentLineStart);
            var nextPos = start - cursorAdjust;
            textarea.selectionStart = textarea.selectionEnd = nextPos;
            return;
          }

          var outdentSelectedText = value.substring(outdentLineStart, end);
          var outdentLines = outdentSelectedText.split("\n");
          var removedFromFirstLine = 0;
          var totalRemoved = 0;
          var outdentedText = outdentLines
            .map(function (line, index) {
              var removeCount = 0;
              if (line.startsWith(indent)) {
                removeCount = indent.length;
              } else if (line.startsWith("\t")) {
                removeCount = 1;
              }
              if (index === 0) removedFromFirstLine = removeCount;
              totalRemoved += removeCount;
              return line.substring(removeCount);
            })
            .join("\n");

          textarea.value =
            value.substring(0, outdentLineStart) +
            outdentedText +
            value.substring(end);
          textarea.selectionStart =
            start - Math.min(removedFromFirstLine, start - outdentLineStart);
          textarea.selectionEnd = end - totalRemoved;
        });

        // Submit request form
        $("#requestform").submit(function (event) {
          event.preventDefault();

          var endpointValid = fieldValidation(
            $("#txtEndpoint"),
            function (val) {
              return val != "" && val.length && val.length > 4;
            },
          );
          var httpbodyValid = true;
          var payload;
          $("#lblHttpBodyError").addClass("hidden").text("");

          if (
            selectedHttpMethod == "POST" ||
            selectedHttpMethod == "PUT" ||
            selectedHttpMethod == "PATCH"
          ) {
            var bodyVal = $("#txtHttpBody").val();
            if (bodyVal && bodyVal.length > 0) {
              try {
                payload = JSON.parse(bodyVal);
              } catch (e) {
                $("#lblHttpBodyError").text(e.toString()).removeClass("hidden");
                httpbodyValid = false;
              }
            }
          }

          if (endpointValid && httpbodyValid) {
            doApiCall(
              selectedHttpMethod,
              $("#txtEndpoint").val(),
              null,
              null,
              payload,
            );
          }
        });

        // Ctrl+Enter to send
        $(document).on("keydown", function (e) {
          if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
            e.preventDefault();
            $("#requestform").submit();
          }
        });
      });

      // ═══════════════════════════════════════════════
      // SHA-256
      // js-sha256 v0.3.0 https://github.com/emn178/js-sha256
      // Copyright 2014-2015, emn178@gmail.com
      // Licensed under the MIT license
      // ═══════════════════════════════════════════════
      (function (I, R) {
        var K = "undefined" != typeof module;
        K && (I = global);
        var a = "0123456789abcdef".split(""),
          Q = [-2147483648, 8388608, 32768, 128],
          C = [24, 16, 8, 0],
          M = [
            1116352408, 1899447441, 3049323471, 3921009573, 961987163,
            1508970993, 2453635748, 2870763221, 3624381080, 310598401,
            607225278, 1426881987, 1925078388, 2162078206, 2614888103,
            3248222580, 3835390401, 4022224774, 264347078, 604807628, 770255983,
            1249150122, 1555081692, 1996064986, 2554220882, 2821834349,
            2952996808, 3210313671, 3336571891, 3584528711, 113926993,
            338241895, 666307205, 773529912, 1294757372, 1396182291, 1695183700,
            1986661051, 2177026350, 2456956037, 2730485921, 2820302411,
            3259730800, 3345764771, 3516065817, 3600352804, 4094571909,
            275423344, 430227734, 506948616, 659060556, 883997877, 958139571,
            1322822218, 1537002063, 1747873779, 1955562222, 2024104815,
            2227730452, 2361852424, 2428436474, 2756734187, 3204031479,
            3329325298,
          ],
          c = [],
          L = function (a) {
            return A(a, !0);
          },
          A = function (D, A) {
            var J = "string" != typeof D;
            J && D.constructor == I.ArrayBuffer && (D = new Uint8Array(D));
            var m,
              n,
              p,
              q,
              r,
              t,
              u,
              v,
              f,
              K = !0,
              L = !1,
              b,
              B = 0,
              N = 0,
              P = 0,
              O = D.length,
              e,
              d,
              E,
              F,
              G,
              H;
            A
              ? ((m = 3238371032),
                (n = 914150663),
                (p = 812702999),
                (q = 4144912697),
                (r = 4290775857),
                (t = 1750603025),
                (u = 1694076839),
                (v = 3204075428))
              : ((m = 1779033703),
                (n = 3144134277),
                (p = 1013904242),
                (q = 2773480762),
                (r = 1359893119),
                (t = 2600822924),
                (u = 528734635),
                (v = 1541459225));
            f = 0;
            do {
              c[0] = f;
              c[16] =
                c[1] =
                c[2] =
                c[3] =
                c[4] =
                c[5] =
                c[6] =
                c[7] =
                c[8] =
                c[9] =
                c[10] =
                c[11] =
                c[12] =
                c[13] =
                c[14] =
                c[15] =
                  0;
              if (J)
                for (b = N; B < O && 64 > b; ++B)
                  c[b >> 2] |= D[B] << C[b++ & 3];
              else
                for (b = N; B < O && 64 > b; ++B)
                  ((f = D.charCodeAt(B)),
                    128 > f
                      ? (c[b >> 2] |= f << C[b++ & 3])
                      : (2048 > f
                          ? (c[b >> 2] |= (192 | (f >> 6)) << C[b++ & 3])
                          : (55296 > f || 57344 <= f
                              ? (c[b >> 2] |= (224 | (f >> 12)) << C[b++ & 3])
                              : (f =
                                  65536 +
                                  (((f & 1023) << 10) |
                                    (D.charCodeAt(++B) & 1023))),
                            (c[b >> 2] |= (240 | (f >> 18)) << C[b++ & 3]),
                            (c[b >> 2] |=
                              (128 | ((f >> 12) & 63)) << C[b++ & 3])),
                        (c[b >> 2] |= (128 | (f & 63)) << C[b++ & 3])));
              P += b - N;
              N = b - 64;
              B == O && ((c[b >> 2] |= Q[b & 3]), ++B);
              f = c[16];
              B > O && 56 > b && ((c[15] = P << 3), (L = !0));
              var w = m,
                k = n,
                l = p,
                g = q,
                x = r,
                y = t,
                z = u,
                h = v;
              for (b = 16; 64 > b; ++b)
                ((d = c[b - 15]),
                  (e =
                    ((d >>> 7) | (d << 25)) ^
                    ((d >>> 18) | (d << 14)) ^
                    (d >>> 3)),
                  (d = c[b - 2]),
                  (d =
                    ((d >>> 17) | (d << 15)) ^
                    ((d >>> 19) | (d << 13)) ^
                    (d >>> 10)),
                  (c[b] = (c[b - 16] + e + c[b - 7] + d) << 0));
              H = k & l;
              for (b = 0; 64 > b; b += 4)
                (K
                  ? (A
                      ? ((G = 300032),
                        (d = c[0] - 1413257819),
                        (h = (d - 150054599) << 0),
                        (g = (d + 24177077) << 0))
                      : ((G = 704751109),
                        (d = c[0] - 210244248),
                        (h = (d - 1521486534) << 0),
                        (g = (d + 143694565) << 0)),
                    (K = !1))
                  : ((e =
                      ((w >>> 2) | (w << 30)) ^
                      ((w >>> 13) | (w << 19)) ^
                      ((w >>> 22) | (w << 10))),
                    (d =
                      ((x >>> 6) | (x << 26)) ^
                      ((x >>> 11) | (x << 21)) ^
                      ((x >>> 25) | (x << 7))),
                    (G = w & k),
                    (E = G ^ (w & l) ^ H),
                    (F = (x & y) ^ (~x & z)),
                    (d = h + d + F + M[b] + c[b]),
                    (e += E),
                    (h = (g + d) << 0),
                    (g = (d + e) << 0)),
                  (e =
                    ((g >>> 2) | (g << 30)) ^
                    ((g >>> 13) | (g << 19)) ^
                    ((g >>> 22) | (g << 10))),
                  (d =
                    ((h >>> 6) | (h << 26)) ^
                    ((h >>> 11) | (h << 21)) ^
                    ((h >>> 25) | (h << 7))),
                  (H = g & w),
                  (E = H ^ (g & k) ^ G),
                  (F = (h & x) ^ (~h & y)),
                  (d = z + d + F + M[b + 1] + c[b + 1]),
                  (e += E),
                  (z = (l + d) << 0),
                  (l = (d + e) << 0),
                  (e =
                    ((l >>> 2) | (l << 30)) ^
                    ((l >>> 13) | (l << 19)) ^
                    ((l >>> 22) | (l << 10))),
                  (d =
                    ((z >>> 6) | (z << 26)) ^
                    ((z >>> 11) | (z << 21)) ^
                    ((z >>> 25) | (z << 7))),
                  (G = l & g),
                  (E = G ^ (l & w) ^ H),
                  (F = (z & h) ^ (~z & x)),
                  (d = y + d + F + M[b + 2] + c[b + 2]),
                  (e += E),
                  (y = (k + d) << 0),
                  (k = (d + e) << 0),
                  (e =
                    ((k >>> 2) | (k << 30)) ^
                    ((k >>> 13) | (k << 19)) ^
                    ((k >>> 22) | (k << 10))),
                  (d =
                    ((y >>> 6) | (y << 26)) ^
                    ((y >>> 11) | (y << 21)) ^
                    ((y >>> 25) | (y << 7))),
                  (H = k & l),
                  (E = H ^ (k & g) ^ G),
                  (F = (y & z) ^ (~y & h)),
                  (d = x + d + F + M[b + 3] + c[b + 3]),
                  (e += E),
                  (x = (w + d) << 0),
                  (w = (d + e) << 0));
              m = (m + w) << 0;
              n = (n + k) << 0;
              p = (p + l) << 0;
              q = (q + g) << 0;
              r = (r + x) << 0;
              t = (t + y) << 0;
              u = (u + z) << 0;
              v = (v + h) << 0;
            } while (!L);
            J =
              a[(m >> 28) & 15] +
              a[(m >> 24) & 15] +
              a[(m >> 20) & 15] +
              a[(m >> 16) & 15] +
              a[(m >> 12) & 15] +
              a[(m >> 8) & 15] +
              a[(m >> 4) & 15] +
              a[m & 15] +
              a[(n >> 28) & 15] +
              a[(n >> 24) & 15] +
              a[(n >> 20) & 15] +
              a[(n >> 16) & 15] +
              a[(n >> 12) & 15] +
              a[(n >> 8) & 15] +
              a[(n >> 4) & 15] +
              a[n & 15] +
              a[(p >> 28) & 15] +
              a[(p >> 24) & 15] +
              a[(p >> 20) & 15] +
              a[(p >> 16) & 15] +
              a[(p >> 12) & 15] +
              a[(p >> 8) & 15] +
              a[(p >> 4) & 15] +
              a[p & 15] +
              a[(q >> 28) & 15] +
              a[(q >> 24) & 15] +
              a[(q >> 20) & 15] +
              a[(q >> 16) & 15] +
              a[(q >> 12) & 15] +
              a[(q >> 8) & 15] +
              a[(q >> 4) & 15] +
              a[q & 15] +
              a[(r >> 28) & 15] +
              a[(r >> 24) & 15] +
              a[(r >> 20) & 15] +
              a[(r >> 16) & 15] +
              a[(r >> 12) & 15] +
              a[(r >> 8) & 15] +
              a[(r >> 4) & 15] +
              a[r & 15] +
              a[(t >> 28) & 15] +
              a[(t >> 24) & 15] +
              a[(t >> 20) & 15] +
              a[(t >> 16) & 15] +
              a[(t >> 12) & 15] +
              a[(t >> 8) & 15] +
              a[(t >> 4) & 15] +
              a[t & 15] +
              a[(u >> 28) & 15] +
              a[(u >> 24) & 15] +
              a[(u >> 20) & 15] +
              a[(u >> 16) & 15] +
              a[(u >> 12) & 15] +
              a[(u >> 8) & 15] +
              a[(u >> 4) & 15] +
              a[u & 15];
            A ||
              (J +=
                a[(v >> 28) & 15] +
                a[(v >> 24) & 15] +
                a[(v >> 20) & 15] +
                a[(v >> 16) & 15] +
                a[(v >> 12) & 15] +
                a[(v >> 8) & 15] +
                a[(v >> 4) & 15] +
                a[v & 15]);
            return J;
          };
        !I.JS_SHA256_TEST && K
          ? ((A.sha256 = A), (A.sha224 = L), (module.exports = A))
          : I && ((I.sha256 = A), (I.sha224 = L));
      })(this);
    </script>
  </body>
</html>
