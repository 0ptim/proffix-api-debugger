<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Proffix API Debugger</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style type="text/tailwindcss">
      @theme {
        --font-sans: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        --font-mono:
          "JetBrains Mono", "Fira Code", "Consolas", ui-monospace, monospace;
      }

      @layer base {
        html {
          @apply overflow-y-scroll text-[15px] antialiased;
          scrollbar-gutter: stable;
        }

        body {
          @apply min-h-screen bg-[#0f1117] font-sans leading-relaxed text-[#e4e6f0];
        }
      }

      @layer components {
        .hidden {
          display: none !important;
        }

        .app {
          @apply mx-auto max-w-[960px] px-5;
        }

        .header {
          @apply sticky top-0 z-[100] mb-6 flex items-center justify-between border-b border-[#2a2d3e] bg-[#0f1117] py-4;
        }

        .header-brand {
          @apply flex items-center gap-2.5 text-[1.1rem] font-bold tracking-[-0.02em] text-[#e4e6f0] no-underline;
        }

        .header-actions {
          @apply flex shrink-0 items-center gap-2;
        }

        .status-bar {
          @apply ml-auto mr-2 flex min-w-0 flex-nowrap items-center gap-3 overflow-x-auto;
        }

        .status-pill {
          @apply inline-flex shrink-0 items-center gap-[7px] whitespace-nowrap rounded-full border border-[#2a2d3e] bg-[#161822] px-3.5 py-1.5 text-[0.8rem] font-medium;
          transition: all 150ms ease;
        }

        .status-pill-btn {
          @apply cursor-pointer select-none hover:border-[#5b6aff] hover:bg-[rgba(91,106,255,0.12)];
        }

        .dot {
          @apply h-[7px] w-[7px] shrink-0 rounded-full;
        }
        .dot.red {
          @apply bg-[#f87171] shadow-[0_0_6px_#f87171];
        }
        .dot.green {
          @apply bg-[#34d399] shadow-[0_0_6px_#34d399];
        }
        .dot.yellow {
          @apply bg-[#fbbf24] shadow-[0_0_6px_#fbbf24];
        }

        .btn {
          @apply inline-flex items-center gap-1.5 whitespace-nowrap rounded-md border border-[#2a2d3e] bg-[#161822] px-4 py-2 text-[0.85rem] leading-[1.4] font-medium text-[#e4e6f0] no-underline transition duration-150 hover:border-[#5a5e78] hover:bg-[#1c1f2e] active:scale-95 disabled:pointer-events-none disabled:opacity-40;
        }

        .btn-primary {
          @apply border-[#5b6aff] bg-[#5b6aff] text-white hover:border-[#4a58e0] hover:bg-[#4a58e0];
        }

        .btn-ghost {
          @apply border-transparent bg-transparent text-[#8b8fa8] hover:bg-[#1c1f2e] hover:text-[#e4e6f0];
        }

        .btn-sm {
          @apply px-2.5 py-[5px] text-[0.78rem];
        }

        .btn-icon {
          @apply inline-flex items-center justify-center rounded-md bg-transparent p-1.5 text-[#8b8fa8] transition duration-150 hover:bg-[#1c1f2e] hover:text-[#e4e6f0];
        }

        .header-actions .btn-icon {
          @apply h-[30px] w-[30px] border border-[#2a2d3e] bg-[#161822] hover:border-[rgba(248,113,113,0.2)] hover:bg-[rgba(248,113,113,0.08)] hover:text-[#f87171];
        }

        .request-builder {
          @apply mb-6 rounded-[14px] border border-[#2a2d3e] bg-[#161822] p-1;
        }

        .request-row {
          @apply flex items-center;
        }

        .method-selector {
          @apply relative;
        }

        .method-btn {
          @apply flex items-center gap-1.5 whitespace-nowrap rounded-[10px] bg-transparent px-3.5 py-2.5 font-mono text-[0.85rem] font-semibold tracking-[0.02em] transition duration-150 hover:bg-[#1c1f2e];
        }
        .method-btn[data-method="GET"] {
          @apply text-emerald-400;
        }
        .method-btn[data-method="POST"] {
          @apply text-amber-400;
        }
        .method-btn[data-method="PUT"] {
          @apply text-orange-400;
        }
        .method-btn[data-method="PATCH"] {
          @apply text-violet-400;
        }
        .method-btn[data-method="DELETE"] {
          @apply text-rose-400;
        }
        .method-btn.open svg {
          @apply rotate-180;
          transition: transform 150ms ease;
        }

        .method-dropdown {
          @apply absolute left-0 top-[calc(100%+4px)] z-[200] hidden min-w-[170px] rounded-[10px] border border-[#2a2d3e] bg-[#232639] p-1 shadow-2xl;
        }
        .method-dropdown.show {
          @apply block;
        }

        .method-option {
          @apply flex w-full items-center gap-2.5 rounded-md bg-transparent px-3 py-2 text-left font-mono text-[0.85rem] font-medium text-[#e4e6f0] transition hover:bg-[#1c1f2e];
        }
        .method-option .method-label {
          @apply ml-auto font-sans text-[0.78rem] font-normal text-[#5a5e78];
        }
        .method-option[data-method="GET"] .method-name {
          @apply text-emerald-400;
        }
        .method-option[data-method="POST"] .method-name {
          @apply text-amber-400;
        }
        .method-option[data-method="PUT"] .method-name {
          @apply text-orange-400;
        }
        .method-option[data-method="PATCH"] .method-name {
          @apply text-violet-400;
        }
        .method-option[data-method="DELETE"] .method-name {
          @apply text-rose-400;
        }

        .endpoint-input {
          @apply min-w-0 flex-1 border-none bg-transparent px-3 py-2.5 font-mono text-[0.9rem] text-[#e4e6f0] outline-none placeholder:text-[#5a5e78];
        }

        .send-btn {
          @apply relative m-0.5 inline-flex h-10 w-10 shrink-0 items-center justify-center rounded-[10px] border-none bg-[#5b6aff] p-0 text-white transition duration-150 hover:bg-[#4a58e0] active:scale-95 disabled:cursor-not-allowed disabled:opacity-40;
          font-size: 0;
          line-height: 1;
        }

        .send-btn .icon-wrap {
          @apply inline-flex h-4 w-4 items-center justify-center;
        }

        .send-btn .shortcut {
          @apply hidden;
        }

        .send-btn .sr-only {
          @apply absolute h-px w-px overflow-hidden whitespace-nowrap border-0 p-0 [clip:rect(0,0,0,0)];
          margin: -1px;
        }

        .body-editor {
          @apply hidden px-1 pt-2 pb-1;
        }
        .body-editor.show {
          @apply block;
        }

        .body-textarea {
          @apply min-h-[180px] w-full resize-y rounded-[10px] border border-[#2a2d3e] bg-[#1a1d2e] p-3.5 font-mono text-[0.85rem] leading-relaxed text-[#e4e6f0] outline-none transition placeholder:text-[#5a5e78] focus:border-[#5b6aff];
        }

        .body-error {
          @apply px-2 pt-1.5 text-[0.8rem] text-[#f87171];
        }

        .section-header {
          @apply mb-4 flex items-center justify-between;
        }

        .section-title {
          @apply text-[0.8rem] font-semibold tracking-[0.08em] text-[#5a5e78] uppercase;
        }

        .log-count {
          @apply ml-2 inline-flex h-5 min-w-5 items-center justify-center rounded-full bg-[#1c1f2e] px-1.5 text-[0.72rem] font-semibold text-[#8b8fa8];
        }

        .log-entry {
          @apply mb-2.5 overflow-hidden rounded-[10px] border border-[#2a2d3e] bg-[#161822] transition duration-150 hover:border-[#5a5e78];
        }
        .log-entry.success {
          @apply border-l-[3px] border-l-emerald-400;
        }
        .log-entry.error {
          @apply border-l-[3px] border-l-rose-400;
        }

        .log-header {
          @apply flex cursor-pointer select-none items-center gap-2.5 px-4 py-3;
        }

        .log-method {
          @apply rounded px-2 py-0.5 font-mono text-[0.78rem] font-bold tracking-[0.03em];
        }
        .log-method.GET {
          @apply bg-emerald-400/10 text-emerald-400;
        }
        .log-method.POST {
          @apply bg-amber-400/10 text-amber-400;
        }
        .log-method.PUT {
          @apply bg-orange-400/10 text-orange-400;
        }
        .log-method.PATCH {
          @apply bg-violet-400/10 text-violet-400;
        }
        .log-method.DELETE {
          @apply bg-rose-400/10 text-rose-400;
        }

        .log-endpoint {
          @apply min-w-0 flex-1 overflow-hidden text-ellipsis whitespace-nowrap font-mono text-[0.85rem] text-[#e4e6f0];
        }

        .log-meta {
          @apply flex shrink-0 items-center gap-3;
        }

        .log-status {
          @apply rounded px-2 py-0.5 font-mono text-[0.78rem] font-semibold;
        }
        .log-status.ok {
          @apply bg-emerald-400/10 text-emerald-400;
        }
        .log-status.err {
          @apply bg-rose-400/10 text-rose-400;
        }

        .log-tab-count {
          @apply ml-1 inline-flex h-4 min-w-4 items-center justify-center rounded-full border border-sky-400/25 bg-sky-400/12 px-1.5 align-middle font-mono text-[0.68rem] leading-none font-semibold text-sky-400;
        }

        .log-duration {
          @apply min-w-[50px] text-right font-mono text-[0.75rem] text-[#5a5e78];
        }

        .log-time {
          @apply text-[0.72rem] text-[#5a5e78];
        }

        .log-delete-btn {
          @apply inline-flex h-5 w-5 items-center justify-center rounded bg-transparent text-[#5a5e78] transition hover:bg-rose-400/12 hover:text-rose-400;
        }

        .log-chevron {
          @apply shrink-0 text-[#5a5e78];
          transition: transform 150ms ease;
        }

        .log-entry.expanded .log-chevron {
          @apply rotate-180;
        }

        .log-body {
          @apply hidden border-t border-[#2a2d3e];
        }
        .log-entry.expanded .log-body {
          @apply block;
        }

        .log-tabs {
          @apply flex border-b border-[#2a2d3e];
        }

        .log-tab {
          @apply cursor-pointer border-b-2 border-transparent bg-transparent px-4 py-2 text-[0.8rem] font-medium text-[#5a5e78] transition hover:text-[#8b8fa8];
        }

        .log-tab.active {
          @apply border-b-[#5b6aff] text-[#5b6aff];
        }

        .log-tab-content {
          @apply hidden;
        }
        .log-tab-content.active {
          @apply block;
        }

        .log-code-wrap {
          @apply relative;
        }

        .log-code {
          @apply max-h-[400px] overflow-x-auto overflow-y-auto break-words whitespace-pre-wrap px-4 py-3.5 font-mono text-[0.8rem] leading-[1.7] text-[#8b8fa8];
        }

        .copy-btn {
          @apply absolute top-2 right-2 z-[5] cursor-pointer rounded-md border border-[#2a2d3e] bg-[#232639] px-2.5 py-1 font-sans text-[0.72rem] font-medium text-[#8b8fa8] transition hover:border-[#5a5e78] hover:text-[#e4e6f0];
        }
        .copy-btn.copied {
          @apply border-emerald-400/20 text-emerald-400;
        }

        .log-location {
          @apply border-b border-[#2a2d3e] px-4 py-2.5 text-[0.8rem];
        }

        .log-location a {
          @apply text-[#5b6aff] no-underline hover:underline;
        }

        .log-empty {
          @apply px-5 py-12 text-center text-[0.9rem] text-[#5a5e78];
        }
        .log-empty svg {
          @apply mb-3 opacity-30;
        }

        .modal-overlay {
          @apply fixed inset-0 z-[1000] hidden items-center justify-center bg-black/60 p-5;
          backdrop-filter: blur(4px);
        }

        .modal-overlay.show {
          @apply flex;
        }

        .modal {
          @apply w-full max-w-[480px] rounded-[14px] border border-[#2a2d3e] bg-[#161822] shadow-2xl;
          animation: modal-in 200ms ease;
        }

        .modal-header {
          @apply flex items-center justify-between border-b border-[#2a2d3e] px-[22px] py-[18px];
        }

        .modal-title {
          @apply text-base font-semibold;
        }

        .modal-close {
          @apply flex cursor-pointer rounded-md bg-transparent p-1 text-[#5a5e78] transition hover:bg-[#1c1f2e] hover:text-[#e4e6f0];
        }

        .modal-body {
          @apply p-[22px];
        }

        .modal-footer {
          @apply flex items-center justify-end gap-2 border-t border-[#2a2d3e] px-[22px] py-4;
        }

        .form-group {
          @apply mb-4;
        }
        .form-group:last-child {
          @apply mb-0;
        }

        .form-label {
          @apply mb-1.5 block text-[0.8rem] font-medium text-[#8b8fa8];
        }

        .form-input,
        .form-select {
          @apply w-full rounded-md border border-[#2a2d3e] bg-[#1a1d2e] px-3 py-[9px] text-[0.85rem] text-[#e4e6f0] outline-none transition placeholder:text-[#5a5e78] focus:border-[#5b6aff];
        }

        .form-select {
          appearance: none;
          background-image: url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L5 5L9 1' stroke='%235a5e78' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
          background-repeat: no-repeat;
          background-position: right 12px center;
          padding-right: 32px;
        }

        .form-select option {
          @apply bg-[#232639] text-[#e4e6f0];
        }

        .form-hint {
          @apply mt-1 text-[0.75rem] text-[#5a5e78];
        }

        .form-group.has-success .form-input,
        .form-group.has-success .form-select {
          @apply border-emerald-400;
        }

        .timeout-banner {
          @apply mb-4 flex items-center gap-2.5 rounded-[10px] border border-amber-400/20 bg-[rgba(251,191,36,0.08)] px-4 py-2.5 text-[0.85rem] text-amber-400;
        }
      }

      @keyframes pulse-dot {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.4;
        }
      }

      .status-pill .dot.pulse {
        animation: pulse-dot 1.2s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .send-btn .spinner {
        width: 16px;
        height: 16px;
        border: 2.5px solid rgba(255, 255, 255, 0.45);
        border-top-color: #fff;
        border-radius: 50%;
        animation: spin 0.6s linear infinite;
        display: block;
        box-sizing: border-box;
      }

      @keyframes modal-in {
        from {
          opacity: 0;
          transform: translateY(10px) scale(0.98);
        }
        to {
          opacity: 1;
          transform: none;
        }
      }

      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: transparent;
      }

      ::-webkit-scrollbar-thumb {
        background: #2a2d3e;
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #5a5e78;
      }

      @media (max-width: 640px) {
        .header {
          @apply flex-wrap gap-2;
        }

        .status-bar {
          @apply order-3 mt-1 w-full overflow-x-auto;
        }

        .request-row {
          @apply flex-wrap;
        }

        .endpoint-input {
          @apply min-w-full;
        }

        .log-meta {
          @apply gap-2;
        }

        .log-duration {
          @apply hidden;
        }
      }
    </style>
  </head>
  <body>
    <div class="app">
      <!-- Header -->
      <header class="header">
        <a class="header-brand" href="">
          <svg
            width="22"
            height="22"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <rect x="3" y="4" width="18" height="16" rx="2" ry="2" />
            <line x1="7" y1="9" x2="17" y2="9" />
            <line x1="7" y1="15" x2="12" y2="15" />
          </svg>
          Proffix API Debugger
        </a>
        <div class="status-bar">
          <!-- Connection states -->
          <div class="status-pill status-pill-btn" id="lblConnectionNot">
            <span class="dot red"></span>
            Not connected
          </div>
          <div
            class="status-pill status-pill-btn hidden"
            id="lblConnectionInProgress"
          >
            <span class="dot yellow pulse"></span>
            Connecting...
          </div>
          <div class="status-pill status-pill-btn hidden" id="lblConnectionOk">
            <span class="dot green"></span>
            API <span id="lblRestApiVersion"></span>&nbsp;·&nbsp;<span
              id="lblRestApiUrl"
              style="opacity: 0.7"
            ></span>
          </div>
          <div
            class="status-pill status-pill-btn hidden"
            id="lblConnectionFailed"
          >
            <span class="dot red"></span>
            Connection failed
          </div>

          <!-- Login states -->
          <div class="status-pill status-pill-btn hidden" id="lblLoginNot">
            <span class="dot red"></span>
            Not logged in
          </div>
          <div
            class="status-pill status-pill-btn hidden"
            id="lblLoginInProgress"
          >
            <span class="dot yellow pulse"></span>
            Logging in...
          </div>
          <div class="status-pill status-pill-btn hidden" id="lblLoginOk">
            <span class="dot green"></span>
            <span id="lblUsername"></span>
          </div>
          <div class="status-pill status-pill-btn hidden" id="lblLoginFailed">
            <span class="dot red"></span>
            Login failed
          </div>
        </div>
        <div class="header-actions">
          <button
            type="button"
            class="btn-icon hidden"
            id="btnLogout"
            title="Logout"
            aria-label="Logout"
          >
            <svg
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
              <polyline points="16 17 21 12 16 7" />
              <line x1="21" y1="12" x2="9" y2="12" />
            </svg>
          </button>
        </div>
      </header>

      <!-- Session Timeout Banner -->
      <div class="timeout-banner hidden" id="lblLoginTimeout">
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <circle cx="12" cy="12" r="10" />
          <line x1="12" y1="8" x2="12" y2="12" />
          <line x1="12" y1="16" x2="12.01" y2="16" />
        </svg>
        Session expired
        <button type="button" class="btn btn-sm" id="btnRelogin">
          Log in again
        </button>
      </div>

      <!-- Request Builder -->
      <div class="request-builder">
        <form id="requestform">
          <div class="request-row">
            <div class="method-selector">
              <button
                type="button"
                class="method-btn"
                id="btnHttpMethod"
                data-method="GET"
              >
                <span class="method-text">GET</span>
                <svg
                  width="12"
                  height="12"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <polyline points="6 9 12 15 18 9" />
                </svg>
              </button>
              <div class="method-dropdown" id="lstHttpMethods">
                <button type="button" class="method-option" data-method="GET">
                  <span class="method-name">GET</span
                  ><span class="method-label">fetch</span>
                </button>
                <button type="button" class="method-option" data-method="POST">
                  <span class="method-name">POST</span
                  ><span class="method-label">create</span>
                </button>
                <button type="button" class="method-option" data-method="PUT">
                  <span class="method-name">PUT</span
                  ><span class="method-label">replace</span>
                </button>
                <button type="button" class="method-option" data-method="PATCH">
                  <span class="method-name">PATCH</span
                  ><span class="method-label">update</span>
                </button>
                <button
                  type="button"
                  class="method-option"
                  data-method="DELETE"
                >
                  <span class="method-name">DELETE</span
                  ><span class="method-label">delete</span>
                </button>
              </div>
            </div>
            <input
              type="text"
              class="endpoint-input"
              id="txtEndpoint"
              placeholder="e.g. ADR/Address/1"
              autocomplete="off"
              spellcheck="false"
            />
            <button
              type="submit"
              class="send-btn"
              id="btnSend"
              disabled
              aria-label="Send (Ctrl+Enter)"
              title="Send (Ctrl+Enter)"
            >
              <span class="icon-wrap" id="iconSend" aria-hidden="true">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <line x1="22" y1="2" x2="11" y2="13" />
                  <polygon points="22 2 15 22 11 13 2 9 22 2" />
                </svg>
              </span>
              <span class="sr-only">Send</span>
              <span class="shortcut">Ctrl+↵</span>
            </button>
          </div>
          <div class="body-editor" id="httpbody">
            <textarea
              class="body-textarea"
              id="txtHttpBody"
              placeholder='{ "key": "value" }'
              spellcheck="false"
            ></textarea>
            <div class="body-error hidden" id="lblHttpBodyError"></div>
          </div>
        </form>
      </div>

      <!-- Log Section -->
      <div class="section-header">
        <div>
          <span class="section-title">Response Log</span>
          <span class="log-count hidden" id="logCount">0</span>
        </div>
        <button type="button" class="btn btn-ghost btn-sm" id="btnLogClear">
          <svg
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <polyline points="3 6 5 6 21 6" />
            <path
              d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
            />
          </svg>
          Clear
        </button>
      </div>

      <div id="output">
        <div class="log-empty" id="logEmpty">
          <svg
            width="40"
            height="40"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="12" r="10" />
            <line x1="12" y1="8" x2="12" y2="12" />
            <line x1="12" y1="16" x2="12.01" y2="16" />
          </svg>
          <div>No requests sent yet</div>
        </div>
      </div>

      <div style="height: 60px"></div>
    </div>

    <!-- Connection Settings Modal -->
    <div class="modal-overlay" id="modalConnectionSettings">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title">Connection settings</h3>
          <button type="button" class="modal-close" data-dismiss="modal">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label" for="txtConnSettRestApiUrl"
              >REST API URL</label
            >
            <input
              type="url"
              class="form-input"
              id="txtConnSettRestApiUrl"
              placeholder="https://remote.proffix.net:11011/pxapi/v4"
            />
            <div class="form-hint">
              e.g. https://remote.proffix.net:11011/pxapi/v4
            </div>
          </div>
          <div class="form-group">
            <label class="form-label" for="txtConnSettRestApiPwd"
              >Password (plain text)</label
            >
            <input
              type="password"
              class="form-input"
              id="txtConnSettRestApiPwd"
              placeholder="Will be hashed automatically"
            />
          </div>
          <div class="form-group">
            <label class="form-label" for="txtConnSettRestApiPwdHash"
              >Password (SHA-256 hash)</label
            >
            <input
              type="password"
              class="form-input"
              id="txtConnSettRestApiPwdHash"
              placeholder="Alternative: already hashed password"
            />
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="btnConnect">
            <svg
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"
              />
              <polyline points="22,6 12,13 2,6" />
            </svg>
            Connect
          </button>
        </div>
      </div>
    </div>

    <!-- Login Modal -->
    <div class="modal-overlay" id="modalLogin">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title">Login</h3>
          <button type="button" class="modal-close" data-dismiss="modal">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label" for="selDatabase">Database</label>
            <select class="form-select" id="selDatabase"></select>
            <div class="form-hint">Log out before switching.</div>
          </div>
          <div class="form-group">
            <label class="form-label" for="txtLoginUsername">Username</label>
            <input
              type="text"
              class="form-input"
              id="txtLoginUsername"
              autocomplete="username"
            />
          </div>
          <div class="form-group">
            <label class="form-label" for="txtLoginPwd"
              >Password (plain text)</label
            >
            <input
              type="password"
              class="form-input"
              id="txtLoginPwd"
              autocomplete="current-password"
            />
          </div>
          <div class="form-group">
            <label class="form-label" for="txtLoginPwdHash"
              >Password (SHA-256 hash)</label
            >
            <input type="password" class="form-input" id="txtLoginPwdHash" />
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="btnLogin">
            <svg
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" />
              <polyline points="10 17 15 12 10 7" />
              <line x1="15" y1="12" x2="3" y2="12" />
            </svg>
            Login
          </button>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
      "use strict";

      // ═══════════════════════════════════════════════
      // State
      // ═══════════════════════════════════════════════
      var loginObject = null;
      var connectionSettings = null;
      var pxSessionId;
      var noOfRequests = 0;
      var wasLoggedIn = false;
      var selectedHttpMethod = "GET";
      var logcounter = 0;

      // ═══════════════════════════════════════════════
      // Custom modal show/hide (replaces Bootstrap modals)
      // ═══════════════════════════════════════════════
      function showModal(id) {
        var el = document.getElementById(id);
        if (el) {
          el.classList.add("show");
        }
      }
      function hideModal(id) {
        var el = document.getElementById(id);
        if (el) {
          el.classList.remove("show");
        }
      }
      // Close on overlay click or dismiss buttons
      $(document).on("click", ".modal-overlay", function (e) {
        if (e.target === this) $(this).removeClass("show");
      });
      $(document).on("click", "[data-dismiss='modal']", function () {
        $(this).closest(".modal-overlay").removeClass("show");
      });
      // Esc to close
      $(document).on("keydown", function (e) {
        if (e.key === "Escape") $(".modal-overlay.show").removeClass("show");
      });

      // ═══════════════════════════════════════════════
      // API Call
      // ═══════════════════════════════════════════════
      var doApiCall = function (method, endpoint, success, error, data) {
        noOfRequests++;
        updateSendButton();

        var starttime = Date.now();
        $.ajax({
          url:
            connectionSettings.url +
            "/" +
            endpoint
              .replace(/^\/+/g, "")
              .replace(/([pP][xX][aA][pP][iI]\/v[0-9]|v[0-9])/g, "")
              .replace(/^\/+/g, ""),
          method: method,
          headers: {
            "Content-Type": "application/json",
            PxSessionId: pxSessionId,
          },
          data: JSON.stringify(data),
          timeout: 60000,
          success: function (responseObject, status, request) {
            var endtime = Date.now();
            pxSessionId = request.getResponseHeader("PxSessionId");
            var responseArrayCount = Array.isArray(responseObject)
              ? responseObject.length
              : null;
            writeLog(
              method.toUpperCase(),
              endpoint,
              request.status,
              request.statusText,
              responseObject ? JSON.stringify(responseObject, null, 2) : "",
              data ? JSON.stringify(data, null, 2) : "",
              endtime - starttime,
              method == "POST" ? request.getResponseHeader("Location") : null,
              responseArrayCount,
            );
            decreaseNoOfRequests();
            $("#lblLoginTimeout").addClass("hidden");
            if (success != undefined) success(responseObject, status);
          },
          error: function (request) {
            var endtime = Date.now();
            pxSessionId = request.getResponseHeader("PxSessionId");
            if (wasLoggedIn && request.status === 401) {
              $("#lblLoginTimeout").removeClass("hidden");
            }
            var responseTextForLog = request.responseText || "";
            var parsedResponseForLog = request.responseJSON;
            if (responseTextForLog.length > 0) {
              try {
                if (!parsedResponseForLog) {
                  parsedResponseForLog = JSON.parse(responseTextForLog);
                }
                responseTextForLog = JSON.stringify(
                  parsedResponseForLog,
                  null,
                  2,
                );
              } catch (e) {}
            }
            writeLog(
              method.toUpperCase(),
              endpoint,
              request.status,
              request.statusText,
              responseTextForLog,
              data ? JSON.stringify(data, null, 2) : "",
              endtime - starttime,
              null,
              Array.isArray(parsedResponseForLog)
                ? parsedResponseForLog.length
                : null,
            );
            decreaseNoOfRequests();
            if (error != undefined) error(request.responseJSON, request.status);
          },
        });
      };

      // ═══════════════════════════════════════════════
      // Send Button State
      // ═══════════════════════════════════════════════
      var updateSendButton = function () {
        if (noOfRequests > 0) {
          $("#iconSend").html('<span class="spinner"></span>');
        } else {
          $("#iconSend").html(
            '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>',
          );
        }
      };

      var decreaseNoOfRequests = function () {
        noOfRequests--;
        if (noOfRequests === 0) updateSendButton();
      };

      // ═══════════════════════════════════════════════
      // Field Validation
      // ═══════════════════════════════════════════════
      var fieldValidation = function (inputElem, validationMethod) {
        var formgroup = inputElem.closest("div.form-group");
        formgroup.removeClass("has-success");
        if (validationMethod(inputElem.val())) {
          formgroup.addClass("has-success");
          return true;
        }
        return false;
      };

      // ═══════════════════════════════════════════════
      // Syntax Highlighting for JSON
      // ═══════════════════════════════════════════════
      function syntaxHighlight(json) {
        if (!json) return "";
        json = json
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
        return json.replace(
          /("(\\u[\da-fA-F]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,
          function (match) {
            var cls = "color:#a78bfa"; // number
            if (/^"/.test(match)) {
              if (/:$/.test(match)) {
                cls = "color:#60a5fa"; // key
              } else {
                cls = "color:#34d399"; // string
              }
            } else if (/true|false/.test(match)) {
              cls = "color:#fbbf24"; // boolean
            } else if (/null/.test(match)) {
              cls = "color:#f87171"; // null
            }
            return '<span style="' + cls + '">' + match + "</span>";
          },
        );
      }

      // ═══════════════════════════════════════════════
      // Write Log Entry
      // ═══════════════════════════════════════════════
      var writeLog = function (
        method,
        endpoint,
        statuscode,
        statuscodetext,
        response,
        request,
        duration,
        locationHeader,
        responseArrayCount,
      ) {
        logcounter++;
        $("#logEmpty").addClass("hidden");

        var isSuccess = statuscode >= 200 && statuscode < 300;
        var statusClass = isSuccess ? "ok" : "err";
        var entryClass = isSuccess ? "success" : "error";
        var now = new Date();
        var timeStr = now.toLocaleTimeString("en-CH", {
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        });

        // Build location HTML
        var locationHtml = "";
        if (locationHeader) {
          if (locationHeader.includes("/PRO/Datei/")) {
            locationHtml =
              '<div class="log-location"><span style="color:var(--text-muted)">Location:</span> <a href="' +
              locationHeader +
              "?pxSessionId=" +
              pxSessionId +
              '" target="_blank">' +
              locationHeader +
              "</a></div>";
          } else {
            locationHtml =
              '<div class="log-location"><span style="color:var(--text-muted)">Location:</span> ' +
              escapeHtml(locationHeader) +
              "</div>";
          }
        }

        var id = "log-" + logcounter;
        var highlightedResponse = response
          ? syntaxHighlight(response)
          : '<span style="color:var(--text-muted)">— leer —</span>';
        var highlightedRequest = request
          ? syntaxHighlight(request)
          : '<span style="color:var(--text-muted)">— leer —</span>';
        var arrayCountBadge =
          typeof responseArrayCount === "number"
            ? '<span class="log-tab-count" title="Top-level array length: ' +
              responseArrayCount +
              '">' +
              responseArrayCount +
              "</span>"
            : "";
        var responseTabLabel = "Response" + arrayCountBadge;
        var endpointDisplay = getEndpointDisplay(endpoint);

        var entry = $(
          '<div class="log-entry ' +
            entryClass +
            ' expanded" data-id="' +
            id +
            '">' +
            '<div class="log-header">' +
            '<span class="log-method ' +
            method +
            '">' +
            method +
            "</span>" +
            '<span class="log-endpoint">' +
            escapeHtml(endpointDisplay) +
            "</span>" +
            '<div class="log-meta">' +
            '<span class="log-status ' +
            statusClass +
            '">' +
            statuscode +
            " " +
            statuscodetext +
            "</span>" +
            '<span class="log-duration">' +
            duration +
            "ms</span>" +
            '<span class="log-time">' +
            timeStr +
            "</span>" +
            '<button type="button" class="log-delete-btn" title="Delete entry" aria-label="Delete entry"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>' +
            '<svg class="log-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>' +
            "</div>" +
            "</div>" +
            '<div class="log-body">' +
            locationHtml +
            '<div class="log-tabs">' +
            '<button type="button" class="log-tab active" data-tab="response-' +
            id +
            '">' +
            responseTabLabel +
            "</button>" +
            '<button type="button" class="log-tab" data-tab="request-' +
            id +
            '">Request</button>' +
            "</div>" +
            '<div class="log-tab-content active" id="response-' +
            id +
            '">' +
            '<div class="log-code-wrap">' +
            '<button type="button" class="copy-btn" data-copy="response" data-id="' +
            id +
            '">Copy</button>' +
            '<div class="log-code">' +
            highlightedResponse +
            "</div>" +
            "</div>" +
            "</div>" +
            '<div class="log-tab-content" id="request-' +
            id +
            '">' +
            '<div class="log-code-wrap">' +
            '<button type="button" class="copy-btn" data-copy="request" data-id="' +
            id +
            '">Copy</button>' +
            '<div class="log-code">' +
            highlightedRequest +
            "</div>" +
            "</div>" +
            "</div>" +
            "</div>" +
            "</div>",
        );

        // Store raw data for copy
        entry.data("response", response || "");
        entry.data("request", request || "");

        $("#output").prepend(entry);
        updateLogCount();
      };

      function updateLogCount() {
        var count = $("#output .log-entry").length;
        if (count > 0) {
          $("#logCount").text(count).removeClass("hidden");
        } else {
          $("#logCount").addClass("hidden");
        }
      }

      function escapeHtml(str) {
        if (!str) return "";
        return str
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;");
      }

      function getApiHostDisplay(url) {
        if (!url) return "";
        try {
          return new URL(url).host;
        } catch (e) {
          return url.replace(/^[a-z]+:\/\//i, "").split("/")[0];
        }
      }

      function getEndpointDisplay(endpoint) {
        if (!endpoint) return "";

        var value = String(endpoint);
        var hashIndex = value.indexOf("#");
        var hash = hashIndex >= 0 ? value.substring(hashIndex) : "";
        var noHash = hashIndex >= 0 ? value.substring(0, hashIndex) : value;

        var queryIndex = noHash.indexOf("?");
        if (queryIndex < 0) return value;

        var path = noHash.substring(0, queryIndex);
        var query = noHash.substring(queryIndex + 1);

        try {
          var params = new URLSearchParams(query);
          var filtered = new URLSearchParams();

          params.forEach(function (paramValue, paramName) {
            if (String(paramName).toLowerCase() !== "key") {
              filtered.append(paramName, paramValue);
            }
          });

          var filteredQuery = filtered.toString();
          return path + (filteredQuery ? "?" + filteredQuery : "") + hash;
        } catch (e) {
          return (
            noHash
              .replace(/([?&])key=[^&#]*&?/gi, "$1")
              .replace(/[?&]$/, "")
              .replace("?&", "?") + hash
          );
        }
      }

      // ═══════════════════════════════════════════════
      // Connect
      // ═══════════════════════════════════════════════
      var doConnect = function () {
        $("#lblConnectionNot").addClass("hidden");
        $("#lblConnectionInProgress").removeClass("hidden");
        $("#lblConnectionOk").addClass("hidden");
        $("#lblConnectionFailed").addClass("hidden");

        doApiCall(
          "GET",
          "PRO/Info?key=" + connectionSettings.pwd,
          function (info) {
            $("#lblConnectionInProgress").addClass("hidden");
            $("#lblConnectionOk").removeClass("hidden");
            $("#lblRestApiVersion").text(info.Version);
            $("#lblRestApiUrl").text(getApiHostDisplay(connectionSettings.url));
            $("#btnSend").removeAttr("disabled");

            // Show login-not after connected
            if (!wasLoggedIn) {
              $("#lblLoginNot").removeClass("hidden");
            }

            // Load databases
            $("#selDatabase option").remove();
            $("#selDatabase")
              .attr("disabled", "disabled")
              .append("<option>No databases found</option>");
            doApiCall(
              "GET",
              "PRO/Datenbank?key=" + connectionSettings.pwd,
              function (databases) {
                $("#selDatabase option").remove();
                $("#selDatabase").removeAttr("disabled");
                $.each(databases, function (index, database) {
                  $("#selDatabase").append(
                    '<option value="' +
                      database.Name +
                      '">' +
                      database.Bezeichnung +
                      " (" +
                      database.Name +
                      ")</option>",
                  );
                });
                if (
                  loginObject &&
                  loginObject.Datenbank &&
                  loginObject.Datenbank.Name
                ) {
                  $("#selDatabase").val(loginObject.Datenbank.Name);
                }
              },
            );
          },
          function () {
            $("#lblConnectionInProgress").addClass("hidden");
            $("#lblConnectionFailed").removeClass("hidden");
          },
        );
      };

      // ═══════════════════════════════════════════════
      // Login
      // ═══════════════════════════════════════════════
      var doLogin = function () {
        $("#lblLoginNot").addClass("hidden");
        $("#lblLoginInProgress").removeClass("hidden");
        $("#lblLoginOk").addClass("hidden");
        $("#lblLoginFailed").addClass("hidden");

        doApiCall(
          "POST",
          "PRO/Login",
          function () {
            $("#lblLoginInProgress").addClass("hidden");
            $("#lblLoginOk").removeClass("hidden");
            $("#btnLogout").removeClass("hidden");
            wasLoggedIn = true;

            doApiCall("GET", "PRO/Login", function (login) {
              $("#lblUsername").text(
                login.Benutzer + " · " + login.Datenbank.Name,
              );
            });
          },
          function () {
            $("#lblLoginInProgress").addClass("hidden");
            $("#lblLoginFailed").removeClass("hidden");
            wasLoggedIn = false;
          },
          loginObject,
        );
      };

      // ═══════════════════════════════════════════════
      // Set HTTP Method
      // ═══════════════════════════════════════════════
      var setHttpMethod = function (method) {
        selectedHttpMethod = method;
        var btn = document.getElementById("btnHttpMethod");
        btn.setAttribute("data-method", method);
        btn.querySelector(".method-text").textContent = method;

        // Show/hide body editor
        var bodyEditor = document.getElementById("httpbody");
        if (method === "POST" || method === "PUT" || method === "PATCH") {
          bodyEditor.classList.add("show");
        } else {
          bodyEditor.classList.remove("show");
        }
      };

      // ═══════════════════════════════════════════════
      // URL Params
      // ═══════════════════════════════════════════════
      var getUrlParam = function (name) {
        var url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
          results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return "";
        return decodeURIComponent(results[2].replace(/\+/g, " "));
      };

      // ═══════════════════════════════════════════════
      // DOM Ready
      // ═══════════════════════════════════════════════
      $(document).ready(function () {
        // URL params
        var paramUrl = getUrlParam("url");
        var paramPwhash = getUrlParam("pwhash");
        if (paramUrl != null && paramPwhash != null) {
          connectionSettings = {
            url: paramUrl + "/pxapi/v4",
            pwd: paramPwhash,
          };
          $("#txtConnSettRestApiUrl").val(connectionSettings.url);
        }

        // Auto-connect and login
        if (connectionSettings) doConnect();
        if (loginObject) doLogin();

        // ═══════════════════════════════════════════════
        // Events
        // ═══════════════════════════════════════════════

        // Connection settings via status pills
        $(
          "#lblConnectionNot, #lblConnectionInProgress, #lblConnectionOk, #lblConnectionFailed",
        ).click(function () {
          showModal("modalConnectionSettings");
        });

        // Login via status pills
        $(
          "#lblLoginNot, #lblLoginInProgress, #lblLoginOk, #lblLoginFailed",
        ).click(function () {
          showModal("modalLogin");
        });

        // Connect
        $("#btnConnect").click(function () {
          if (
            fieldValidation($("#txtConnSettRestApiUrl"), function (val) {
              return val != "";
            })
          ) {
            let passwordHash;
            const clearTextPassword = $("#txtConnSettRestApiPwd").val();
            if (clearTextPassword) {
              passwordHash = sha256(clearTextPassword).toString();
            } else {
              passwordHash = $("#txtConnSettRestApiPwdHash").val();
            }
            if (passwordHash) {
              connectionSettings = {
                url: $("#txtConnSettRestApiUrl").val(),
                pwd: passwordHash,
              };
              doConnect();
              hideModal("modalConnectionSettings");
            } else {
              alert("Please enter a password or password hash.");
            }
          }
        });

        // Login
        $("#btnLogin").click(function () {
          if (
            fieldValidation($("#selDatabase"), function (val) {
              return val != "";
            }) &&
            fieldValidation($("#txtLoginUsername"), function (val) {
              return val != "";
            })
          ) {
            var modArr = ["VOL"];
            let passwordHash;
            const clearTextPassword = $("#txtLoginPwd").val();
            if (clearTextPassword) {
              passwordHash = sha256(clearTextPassword).toString();
            } else {
              passwordHash = $("#txtLoginPwdHash").val();
            }
            if (passwordHash) {
              loginObject = {
                Benutzer: $("#txtLoginUsername").val(),
                Passwort: passwordHash,
                Module: modArr,
                Datenbank: { Name: $("#selDatabase").val() },
              };
              doLogin();
              hideModal("modalLogin");
            } else {
              alert("Please enter a password or password hash.");
            }
          }
        });

        // Logout
        $("#btnLogout").click(function () {
          doApiCall("DELETE", "PRO/Login");
          $("#lblLoginInProgress").addClass("hidden");
          $("#lblLoginOk").addClass("hidden");
          $("#lblLoginFailed").addClass("hidden");
          $("#lblLoginTimeout").addClass("hidden");
          $("#lblLoginNot").removeClass("hidden");
          $("#btnLogout").addClass("hidden");
        });

        // Relogin
        $("#btnRelogin").click(function () {
          doLogin();
        });

        // Clear log
        $("#btnLogClear").click(function () {
          $("#output").empty();
          $("#output").append(
            '<div class="log-empty" id="logEmpty"><svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><div>No requests sent yet</div></div>',
          );
          logcounter = 0;
          updateLogCount();
        });

        // Method dropdown
        $("#btnHttpMethod").click(function (e) {
          e.stopPropagation();
          var dd = $("#lstHttpMethods");
          dd.toggleClass("show");
          $(this).toggleClass("open");
        });

        $(document).click(function () {
          $("#lstHttpMethods").removeClass("show");
          $("#btnHttpMethod").removeClass("open");
        });

        $(".method-option").click(function (e) {
          e.preventDefault();
          e.stopPropagation();
          setHttpMethod($(this).attr("data-method"));
          $("#lstHttpMethods").removeClass("show");
          $("#btnHttpMethod").removeClass("open");
        });

        // Log entry expand/collapse
        $(document).on("click", ".log-header", function () {
          $(this).closest(".log-entry").toggleClass("expanded");
        });

        // Delete single log entry
        $(document).on("click", ".log-delete-btn", function (e) {
          e.stopPropagation();
          $(this).closest(".log-entry").remove();
          if ($("#output .log-entry").length === 0) {
            var empty = $("#logEmpty");
            if (empty.length > 0) {
              empty.removeClass("hidden");
            } else {
              $("#output").append(
                '<div class="log-empty" id="logEmpty"><svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><div>No requests sent yet</div></div>',
              );
            }
          }
          updateLogCount();
        });

        // Log tabs
        $(document).on("click", ".log-tab", function (e) {
          e.stopPropagation();
          var entry = $(this).closest(".log-entry");
          entry.find(".log-tab").removeClass("active");
          entry.find(".log-tab-content").removeClass("active");
          $(this).addClass("active");
          entry.find("#" + $(this).data("tab")).addClass("active");
        });

        // Copy button
        $(document).on("click", ".copy-btn", function (e) {
          e.stopPropagation();
          var btn = $(this);
          var entry = btn.closest(".log-entry");
          var type = btn.data("copy");
          var text = entry.data(type) || "";

          navigator.clipboard.writeText(text).then(function () {
            btn.text("Copied!").addClass("copied");
            setTimeout(function () {
              btn.text("Copy").removeClass("copied");
            }, 1500);
          });
        });

        // JSON body editor: keep focus on Tab and indent/outdent
        $(document).on("keydown", "#txtHttpBody", function (e) {
          if (e.key !== "Tab" || e.ctrlKey || e.metaKey || e.altKey) return;

          e.preventDefault();
          var textarea = this;
          var value = textarea.value;
          var start = textarea.selectionStart;
          var end = textarea.selectionEnd;
          var indent = "  ";
          var hasSelection = start !== end;

          if (!e.shiftKey) {
            if (!hasSelection) {
              textarea.value =
                value.substring(0, start) + indent + value.substring(end);
              textarea.selectionStart = textarea.selectionEnd =
                start + indent.length;
              return;
            }

            var indentLineStart = value.lastIndexOf("\n", start - 1) + 1;
            var indentSelectedText = value.substring(indentLineStart, end);
            var indentLines = indentSelectedText.split("\n");
            var indentedText = indentLines
              .map(function (line) {
                return indent + line;
              })
              .join("\n");

            textarea.value =
              value.substring(0, indentLineStart) +
              indentedText +
              value.substring(end);
            textarea.selectionStart = start + indent.length;
            textarea.selectionEnd = end + indent.length * indentLines.length;
            return;
          }

          var outdentLineStart = value.lastIndexOf("\n", start - 1) + 1;

          if (!hasSelection) {
            var currentLineEnd = value.indexOf("\n", start);
            if (currentLineEnd === -1) currentLineEnd = value.length;
            var currentLine = value.substring(outdentLineStart, currentLineEnd);
            var removeCount = 0;
            if (currentLine.startsWith(indent)) {
              removeCount = indent.length;
            } else if (currentLine.startsWith("\t")) {
              removeCount = 1;
            }
            if (removeCount === 0) return;

            textarea.value =
              value.substring(0, outdentLineStart) +
              currentLine.substring(removeCount) +
              value.substring(currentLineEnd);
            var cursorAdjust = Math.min(removeCount, start - outdentLineStart);
            var nextPos = start - cursorAdjust;
            textarea.selectionStart = textarea.selectionEnd = nextPos;
            return;
          }

          var outdentSelectedText = value.substring(outdentLineStart, end);
          var outdentLines = outdentSelectedText.split("\n");
          var removedFromFirstLine = 0;
          var totalRemoved = 0;
          var outdentedText = outdentLines
            .map(function (line, index) {
              var removeCount = 0;
              if (line.startsWith(indent)) {
                removeCount = indent.length;
              } else if (line.startsWith("\t")) {
                removeCount = 1;
              }
              if (index === 0) removedFromFirstLine = removeCount;
              totalRemoved += removeCount;
              return line.substring(removeCount);
            })
            .join("\n");

          textarea.value =
            value.substring(0, outdentLineStart) +
            outdentedText +
            value.substring(end);
          textarea.selectionStart =
            start - Math.min(removedFromFirstLine, start - outdentLineStart);
          textarea.selectionEnd = end - totalRemoved;
        });

        // Submit request form
        $("#requestform").submit(function (event) {
          event.preventDefault();

          var endpointValid = fieldValidation(
            $("#txtEndpoint"),
            function (val) {
              return val != "" && val.length && val.length > 4;
            },
          );
          var httpbodyValid = true;
          var payload;
          $("#lblHttpBodyError").addClass("hidden").text("");

          if (
            selectedHttpMethod == "POST" ||
            selectedHttpMethod == "PUT" ||
            selectedHttpMethod == "PATCH"
          ) {
            var bodyVal = $("#txtHttpBody").val();
            if (bodyVal && bodyVal.length > 0) {
              try {
                payload = JSON.parse(bodyVal);
              } catch (e) {
                $("#lblHttpBodyError").text(e.toString()).removeClass("hidden");
                httpbodyValid = false;
              }
            }
          }

          if (endpointValid && httpbodyValid) {
            doApiCall(
              selectedHttpMethod,
              $("#txtEndpoint").val(),
              null,
              null,
              payload,
            );
          }
        });

        // Ctrl+Enter to send
        $(document).on("keydown", function (e) {
          if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
            e.preventDefault();
            $("#requestform").submit();
          }
        });
      });

      // ═══════════════════════════════════════════════
      // SHA-256
      // js-sha256 v0.3.0 https://github.com/emn178/js-sha256
      // Copyright 2014-2015, emn178@gmail.com
      // Licensed under the MIT license
      // ═══════════════════════════════════════════════
      (function (I, R) {
        var K = "undefined" != typeof module;
        K && (I = global);
        var a = "0123456789abcdef".split(""),
          Q = [-2147483648, 8388608, 32768, 128],
          C = [24, 16, 8, 0],
          M = [
            1116352408, 1899447441, 3049323471, 3921009573, 961987163,
            1508970993, 2453635748, 2870763221, 3624381080, 310598401,
            607225278, 1426881987, 1925078388, 2162078206, 2614888103,
            3248222580, 3835390401, 4022224774, 264347078, 604807628, 770255983,
            1249150122, 1555081692, 1996064986, 2554220882, 2821834349,
            2952996808, 3210313671, 3336571891, 3584528711, 113926993,
            338241895, 666307205, 773529912, 1294757372, 1396182291, 1695183700,
            1986661051, 2177026350, 2456956037, 2730485921, 2820302411,
            3259730800, 3345764771, 3516065817, 3600352804, 4094571909,
            275423344, 430227734, 506948616, 659060556, 883997877, 958139571,
            1322822218, 1537002063, 1747873779, 1955562222, 2024104815,
            2227730452, 2361852424, 2428436474, 2756734187, 3204031479,
            3329325298,
          ],
          c = [],
          L = function (a) {
            return A(a, !0);
          },
          A = function (D, A) {
            var J = "string" != typeof D;
            J && D.constructor == I.ArrayBuffer && (D = new Uint8Array(D));
            var m,
              n,
              p,
              q,
              r,
              t,
              u,
              v,
              f,
              K = !0,
              L = !1,
              b,
              B = 0,
              N = 0,
              P = 0,
              O = D.length,
              e,
              d,
              E,
              F,
              G,
              H;
            A
              ? ((m = 3238371032),
                (n = 914150663),
                (p = 812702999),
                (q = 4144912697),
                (r = 4290775857),
                (t = 1750603025),
                (u = 1694076839),
                (v = 3204075428))
              : ((m = 1779033703),
                (n = 3144134277),
                (p = 1013904242),
                (q = 2773480762),
                (r = 1359893119),
                (t = 2600822924),
                (u = 528734635),
                (v = 1541459225));
            f = 0;
            do {
              c[0] = f;
              c[16] =
                c[1] =
                c[2] =
                c[3] =
                c[4] =
                c[5] =
                c[6] =
                c[7] =
                c[8] =
                c[9] =
                c[10] =
                c[11] =
                c[12] =
                c[13] =
                c[14] =
                c[15] =
                  0;
              if (J)
                for (b = N; B < O && 64 > b; ++B)
                  c[b >> 2] |= D[B] << C[b++ & 3];
              else
                for (b = N; B < O && 64 > b; ++B)
                  ((f = D.charCodeAt(B)),
                    128 > f
                      ? (c[b >> 2] |= f << C[b++ & 3])
                      : (2048 > f
                          ? (c[b >> 2] |= (192 | (f >> 6)) << C[b++ & 3])
                          : (55296 > f || 57344 <= f
                              ? (c[b >> 2] |= (224 | (f >> 12)) << C[b++ & 3])
                              : (f =
                                  65536 +
                                  (((f & 1023) << 10) |
                                    (D.charCodeAt(++B) & 1023))),
                            (c[b >> 2] |= (240 | (f >> 18)) << C[b++ & 3]),
                            (c[b >> 2] |=
                              (128 | ((f >> 12) & 63)) << C[b++ & 3])),
                        (c[b >> 2] |= (128 | (f & 63)) << C[b++ & 3])));
              P += b - N;
              N = b - 64;
              B == O && ((c[b >> 2] |= Q[b & 3]), ++B);
              f = c[16];
              B > O && 56 > b && ((c[15] = P << 3), (L = !0));
              var w = m,
                k = n,
                l = p,
                g = q,
                x = r,
                y = t,
                z = u,
                h = v;
              for (b = 16; 64 > b; ++b)
                ((d = c[b - 15]),
                  (e =
                    ((d >>> 7) | (d << 25)) ^
                    ((d >>> 18) | (d << 14)) ^
                    (d >>> 3)),
                  (d = c[b - 2]),
                  (d =
                    ((d >>> 17) | (d << 15)) ^
                    ((d >>> 19) | (d << 13)) ^
                    (d >>> 10)),
                  (c[b] = (c[b - 16] + e + c[b - 7] + d) << 0));
              H = k & l;
              for (b = 0; 64 > b; b += 4)
                (K
                  ? (A
                      ? ((G = 300032),
                        (d = c[0] - 1413257819),
                        (h = (d - 150054599) << 0),
                        (g = (d + 24177077) << 0))
                      : ((G = 704751109),
                        (d = c[0] - 210244248),
                        (h = (d - 1521486534) << 0),
                        (g = (d + 143694565) << 0)),
                    (K = !1))
                  : ((e =
                      ((w >>> 2) | (w << 30)) ^
                      ((w >>> 13) | (w << 19)) ^
                      ((w >>> 22) | (w << 10))),
                    (d =
                      ((x >>> 6) | (x << 26)) ^
                      ((x >>> 11) | (x << 21)) ^
                      ((x >>> 25) | (x << 7))),
                    (G = w & k),
                    (E = G ^ (w & l) ^ H),
                    (F = (x & y) ^ (~x & z)),
                    (d = h + d + F + M[b] + c[b]),
                    (e += E),
                    (h = (g + d) << 0),
                    (g = (d + e) << 0)),
                  (e =
                    ((g >>> 2) | (g << 30)) ^
                    ((g >>> 13) | (g << 19)) ^
                    ((g >>> 22) | (g << 10))),
                  (d =
                    ((h >>> 6) | (h << 26)) ^
                    ((h >>> 11) | (h << 21)) ^
                    ((h >>> 25) | (h << 7))),
                  (H = g & w),
                  (E = H ^ (g & k) ^ G),
                  (F = (h & x) ^ (~h & y)),
                  (d = z + d + F + M[b + 1] + c[b + 1]),
                  (e += E),
                  (z = (l + d) << 0),
                  (l = (d + e) << 0),
                  (e =
                    ((l >>> 2) | (l << 30)) ^
                    ((l >>> 13) | (l << 19)) ^
                    ((l >>> 22) | (l << 10))),
                  (d =
                    ((z >>> 6) | (z << 26)) ^
                    ((z >>> 11) | (z << 21)) ^
                    ((z >>> 25) | (z << 7))),
                  (G = l & g),
                  (E = G ^ (l & w) ^ H),
                  (F = (z & h) ^ (~z & x)),
                  (d = y + d + F + M[b + 2] + c[b + 2]),
                  (e += E),
                  (y = (k + d) << 0),
                  (k = (d + e) << 0),
                  (e =
                    ((k >>> 2) | (k << 30)) ^
                    ((k >>> 13) | (k << 19)) ^
                    ((k >>> 22) | (k << 10))),
                  (d =
                    ((y >>> 6) | (y << 26)) ^
                    ((y >>> 11) | (y << 21)) ^
                    ((y >>> 25) | (y << 7))),
                  (H = k & l),
                  (E = H ^ (k & g) ^ G),
                  (F = (y & z) ^ (~y & h)),
                  (d = x + d + F + M[b + 3] + c[b + 3]),
                  (e += E),
                  (x = (w + d) << 0),
                  (w = (d + e) << 0));
              m = (m + w) << 0;
              n = (n + k) << 0;
              p = (p + l) << 0;
              q = (q + g) << 0;
              r = (r + x) << 0;
              t = (t + y) << 0;
              u = (u + z) << 0;
              v = (v + h) << 0;
            } while (!L);
            J =
              a[(m >> 28) & 15] +
              a[(m >> 24) & 15] +
              a[(m >> 20) & 15] +
              a[(m >> 16) & 15] +
              a[(m >> 12) & 15] +
              a[(m >> 8) & 15] +
              a[(m >> 4) & 15] +
              a[m & 15] +
              a[(n >> 28) & 15] +
              a[(n >> 24) & 15] +
              a[(n >> 20) & 15] +
              a[(n >> 16) & 15] +
              a[(n >> 12) & 15] +
              a[(n >> 8) & 15] +
              a[(n >> 4) & 15] +
              a[n & 15] +
              a[(p >> 28) & 15] +
              a[(p >> 24) & 15] +
              a[(p >> 20) & 15] +
              a[(p >> 16) & 15] +
              a[(p >> 12) & 15] +
              a[(p >> 8) & 15] +
              a[(p >> 4) & 15] +
              a[p & 15] +
              a[(q >> 28) & 15] +
              a[(q >> 24) & 15] +
              a[(q >> 20) & 15] +
              a[(q >> 16) & 15] +
              a[(q >> 12) & 15] +
              a[(q >> 8) & 15] +
              a[(q >> 4) & 15] +
              a[q & 15] +
              a[(r >> 28) & 15] +
              a[(r >> 24) & 15] +
              a[(r >> 20) & 15] +
              a[(r >> 16) & 15] +
              a[(r >> 12) & 15] +
              a[(r >> 8) & 15] +
              a[(r >> 4) & 15] +
              a[r & 15] +
              a[(t >> 28) & 15] +
              a[(t >> 24) & 15] +
              a[(t >> 20) & 15] +
              a[(t >> 16) & 15] +
              a[(t >> 12) & 15] +
              a[(t >> 8) & 15] +
              a[(t >> 4) & 15] +
              a[t & 15] +
              a[(u >> 28) & 15] +
              a[(u >> 24) & 15] +
              a[(u >> 20) & 15] +
              a[(u >> 16) & 15] +
              a[(u >> 12) & 15] +
              a[(u >> 8) & 15] +
              a[(u >> 4) & 15] +
              a[u & 15];
            A ||
              (J +=
                a[(v >> 28) & 15] +
                a[(v >> 24) & 15] +
                a[(v >> 20) & 15] +
                a[(v >> 16) & 15] +
                a[(v >> 12) & 15] +
                a[(v >> 8) & 15] +
                a[(v >> 4) & 15] +
                a[v & 15]);
            return J;
          };
        !I.JS_SHA256_TEST && K
          ? ((A.sha256 = A), (A.sha224 = L), (module.exports = A))
          : I && ((I.sha256 = A), (I.sha224 = L));
      })(this);
    </script>
  </body>
</html>
